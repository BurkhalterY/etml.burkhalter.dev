import{u as P,d as j,r as Q,p as ee,e as W,q,o as n,a as r,f as e,t as l,g as h,w as f,v as H,b as t,h as $,s as B,F as N,m as T,x as te,y as oe,z as se,A as ae,B as ue,c as X,i as I,C as ce,D as pe,T as me,E as _e,n as Z}from"./index-f2d8742b.js";import{a as he,b as K,M as be,D as ge,u as ne}from"./auth-7d10d268.js";const ve={class:"flex flex-col gap-2"},xe=t("h2",{class:"text-xl font-bold text-center"},"Devoir",-1),ye={key:0,class:"text-red-500"},we={key:1,class:"text-red-500"},De=t("label",null,"Date :",-1),ke=t("label",null,"Classe :",-1),fe=t("option",{value:"mtu1e"},"MTU1E",-1),$e=t("option",{value:"mtu2e"},"MTU2E",-1),Se=[fe,$e],Ee=t("label",null,"Type :",-1),Ne=t("option",{value:"homework"},"Devoir",-1),Te=t("option",{value:"test"},"Test",-1),Ce=t("option",{value:"info"},"Information",-1),Me=[Ne,Te,Ce],Ue=t("label",null,"Matière :",-1),Ae=["value"],Qe=t("label",null,"Titre :",-1),Ie={class:"flex gap-1"},Ke=["disabled"],L={__name:"TaskForm",setup(F){var R;const d=P(),x=j(),i=Q({...x.additionalData}),m=Q(((R=i.value.matter)==null?void 0:R.abbr)??""),_=Q({...i.value}),{result:c}=ee(he),{mutate:u,error:C,onDone:w}=W(be,()=>({variables:{...i.value,matter:m.value},update:(g,{data:{task:o}})=>{if(_.value.id){const y=new Date(_.value.date),z=(y.getDay()+6)%7,{year:re,week:le}=q(y),G={query:K,variables:{promotion:d.params.promotion,year:re,week:le}},ie=g.readQuery(G),Y=JSON.parse(JSON.stringify(ie));Y.week.days[z].tasks=Y.week.days[z].tasks.filter(de=>de.id!=_.value.id),g.writeQuery({...G,data:Y})}const v=new Date(o.date),s=(v.getDay()+6)%7,{year:J,week:U}=q(v),A={query:K,variables:{promotion:d.params.promotion,year:J,week:U}},D=g.readQuery(A);if(D){const y=JSON.parse(JSON.stringify(D));y.week.days[s].tasks.push(o),g.writeQuery({...A,data:y})}}}));w(()=>{x.component=!1});const{mutate:V,error:k,onDone:M}=W(ge,()=>({variables:{id:_.value.id},update:g=>{const o=new Date(_.value.date),v=(o.getDay()+6)%7,{year:s,week:J}=q(o),U={query:K,variables:{promotion:d.params.promotion,year:s,week:J}},A=g.readQuery(U),D=JSON.parse(JSON.stringify(A));D.week.days[v].tasks=D.week.days[v].tasks.filter(y=>y.id!=_.value.id),g.writeQuery({...U,data:D})}}));M(()=>{x.component=!1});const b=Q(3);let a;const O=()=>{b.value--,a=setInterval(()=>{b.value--,b.value==0&&clearInterval(a)},1e3)},p=()=>{clearInterval(a),b.value=3};return(g,o)=>{var v;return n(),r("div",ve,[xe,e(C)?(n(),r("span",ye,l(e(C).message),1)):h("",!0),e(k)?(n(),r("span",we,l(e(k).message),1)):h("",!0),De,f(t("input",{type:"date","onUpdate:modelValue":o[0]||(o[0]=s=>i.value.date=s),class:"p-2 border rounded-sm",onKeyup:o[1]||(o[1]=$((...s)=>e(u)&&e(u)(...s),["enter"]))},null,544),[[H,i.value.date]]),ke,f(t("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>i.value.promotion=s),class:"p-2 bg-white border rounded-sm",onKeyup:o[3]||(o[3]=$((...s)=>e(u)&&e(u)(...s),["enter"]))},Se,544),[[B,i.value.promotion]]),Ee,f(t("select",{"onUpdate:modelValue":o[4]||(o[4]=s=>i.value.type=s),class:"p-2 bg-white border rounded-sm",onKeyup:o[5]||(o[5]=$((...s)=>e(u)&&e(u)(...s),["enter"]))},Me,544),[[B,i.value.type]]),Ue,f(t("select",{"onUpdate:modelValue":o[6]||(o[6]=s=>m.value=s),class:"p-2 bg-white border rounded-sm",onKeyup:o[7]||(o[7]=$((...s)=>e(u)&&e(u)(...s),["enter"]))},[(n(!0),r(N,null,T(((v=e(c))==null?void 0:v.matters)||[],s=>(n(),r("option",{value:s.abbr},l(s.name),9,Ae))),256))],544),[[B,m.value]]),Qe,f(t("input",{type:"text","onUpdate:modelValue":o[8]||(o[8]=s=>i.value.title=s),class:"p-2 border rounded-sm",onKeyup:o[9]||(o[9]=$((...s)=>e(u)&&e(u)(...s),["enter"]))},null,544),[[H,i.value.title]]),t("div",Ie,[t("button",{onClick:o[10]||(o[10]=(...s)=>e(u)&&e(u)(...s)),class:"flex-grow p-2 mt-2 text-white rounded-sm bg-etml hover:opacity-90 active:opacity-80"}," Valider "),i.value.id?(n(),r("button",{key:0,onMouseenter:O,onMouseleave:p,onClick:o[11]||(o[11]=(...s)=>e(V)&&e(V)(...s)),class:"p-2 mt-2 font-bold text-white bg-red-600 rounded-sm hover:opacity-90 active:opacity-80 aspect-square disabled:cursor-not-allowed",disabled:b.value},l(b.value||"⨉"),41,Ke)):h("",!0)])])}}},Ve={class:"px-1 text-white bg-orange-700"},Oe={class:"text-2xl font-light"},Re={class:"ml-2 font-light uppercase text-md"},Je={class:"float-right text-2xl font-light"},Ye={class:"leading-relaxed border-b border-orange-700"},qe=t("td",{class:"inline-block w-4 h-4 border border-orange-700 cursor-pointer"},null,-1),Be={key:0,class:"px-2 font-bold align-top"},Le=["colspan"],Pe={key:1,class:"align-top"},je=["onClick"],Fe={__name:"DayPopup",setup(F){const d=j(),x=ne(),i=P();return(m,_)=>(n(),r("div",null,[t("h2",Ve,[t("span",Oe,l(e(d).additionalData.day.date.getDate()),1),t("span",Re,l(e(te)[e(d).additionalData.day.date.getDay()]),1),t("span",Je,l(e(oe)[e(d).additionalData.day.date.getMonth()]),1)]),t("table",null,[(n(!0),r(N,null,T([...e(d).additionalData.day.tasks].sort(e(ae)),c=>(n(),r("tr",Ye,[qe,c.matter.shortName?(n(),r("td",Be,l(c.matter.abbr=="ecdr"&&e(i).params.promotion=="mtu2e"?"Droit":c.matter.shortName),1)):h("",!0),t("td",{class:"px-2 align-top",colspan:c.matter.shortName?1:2},l(e(se)[c.type].emoji)+" "+l(c.title),9,Le),e(x).admin?(n(),r("td",Pe,[t("button",{onClick:u=>{e(d).component=L,e(d).additionalData=c},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Editer ",8,je)])):h("",!0)]))),256))])]))}},ze={class:"flex flex-col flex-wrap gap-y-4 gap-x-16"},Ge={class:"w-full xl:w-1/2 xl:pr-16"},We={class:"text-2xl font-light border-b border-black"},He={class:"float-right"},Xe={class:"w-full border-b border-orange-700"},Ze=t("h2",{class:"inline font-bold text-orange-700 uppercase text-2xs"},[t("b",null,"Communications")],-1),et=t("span",{class:"mx-3 text-red-500"},"Une erreur est survenue",-1),tt=t("div",{class:"w-full border-b border-orange-700"}," ",-1),ot=t("div",{class:"w-full border-b border-orange-700"}," ",-1),st={class:"w-full xl:w-1/2 xl:pr-16"},at=["onClick"],nt={class:"text-2xl font-light"},rt={class:"ml-2 font-light uppercase text-md"},lt={key:0,class:"float-right text-2xl font-light"},it=t("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"},null,-1),dt={key:0,class:"inline-block w-20"},ut=["title"],ct=["onClick"],pt={class:"leading-relaxed border-b border-orange-700"},mt={key:0},_t=["onClick"],ht={class:"leading-relaxed border-b border-orange-700"},S=5,E=3,vt={__name:"AgendaPage",setup(F){const d=P(),x=ue(),i=ne(),m=j(),_=X(()=>{const w=parseInt(d.params.week);return w>26&&w<34&&x.push({name:d.name,params:{...d.params,week:34}}),w}),c=X(()=>_e(d.params.promotion,_.value)),{result:u,error:C}=ee(K,()=>({promotion:d.params.promotion,year:c.value,week:_.value}));return(w,V)=>{var k,M,b;return n(),r("div",ze,[t("div",Ge,[t("h1",We,[I(" Semaine "+l(_.value)+" ",1),t("span",He,l(c.value),1)]),t("div",Xe,[Ze,e(C)?(n(),ce(me,{key:0,appear:""},{default:pe(()=>[et]),_:1})):h("",!0)]),tt,ot]),(n(!0),r(N,null,T(((b=(M=(k=e(u))==null?void 0:k.week)==null?void 0:M.days)==null?void 0:b.map(a=>({...a,strDate:a.date,date:new Date(a.date)})))||[],(a,O)=>(n(),r("div",st,[t("h2",{class:Z(["px-1 text-white bg-orange-700",{"cursor-pointer":a.tasks.length}]),onClick:p=>a.tasks.length?[e(m).component=Fe,e(m).additionalData={day:a}]:[]},[t("span",nt,l(a.date.getDate()),1),t("span",rt,l(e(te)[a.date.getDay()]),1),O==0||a.date.getDate()==1?(n(),r("span",lt,l(e(oe)[a.date.getMonth()]),1)):h("",!0)],10,at),t("ul",null,[(n(!0),r(N,null,T([...a.tasks].sort(e(ae)).slice(0,(a.date.getDay()?S:E)-1),p=>(n(),r("li",{class:Z(["relative leading-relaxed truncate border-b border-orange-700",{"pr-8":e(i).admin}])},[it,I(" "+l()+" ",1),p.matter.shortName?(n(),r("strong",dt,l(p.matter.abbr=="ecdr"&&e(d).params.promotion=="mtu2e"?"Droit":p.matter.shortName),1)):h("",!0),I(" "+l(e(se)[p.type].emoji)+" ",1),t("span",{title:p.title},l(p.title),9,ut),e(i).admin?(n(),r("button",{key:1,onClick:R=>{e(m).component=L,e(m).additionalData=p},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml absolute right-0 my-1"}," Éditer ",8,ct)):h("",!0)],2))),256)),t("li",pt,[a.tasks.length>=(a.date.getDay()?S:E)?(n(),r("span",mt," + "+l(a.tasks.length+1-(a.date.getDay()?S:E))+" "+l(a.tasks.length+1-(a.date.getDay()?S:E)>=2?"autres éléments":"autre élément"),1)):h("",!0),e(i).admin?(n(),r("button",{key:1,onClick:p=>{e(m).component=L,e(m).additionalData={date:a.strDate,promotion:"mtu2e",matter:"",type:"homework",title:""}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Ajouter ",8,_t)):h("",!0),I("   ")]),(n(!0),r(N,null,T(Math.max((a.date.getDay()?S:E)-a.tasks.length-1,0),p=>(n(),r("li",ht,"   "))),256))])]))),256))])}}};export{vt as default};
