import{G as at,a as U,M as st,D as nt,u as P}from"./auth.77793ac3.js";import{u as Y,r as K,y as j,e as L,A as Q,o as l,c as i,b as t,t as p,d as b,w as y,v as O,a as e,f as x,g as R,F as k,z as $,B as F,C as z,D as W,E as H,G as X,h as f,n as rt}from"./index.85541a30.js";const lt={class:"flex flex-col gap-2"},it=e("h2",{class:"text-xl font-bold text-center"},"Devoir",-1),dt={key:0,class:"text-red-500"},ut={key:1,class:"text-red-500"},pt=e("label",null,"Date :",-1),ct=e("label",null,"Classe :",-1),mt=e("option",{value:"mtu1e"},"MTU1E",-1),_t=[mt],bt=e("label",null,"Type :",-1),gt=e("option",{value:"homework"},"Devoir",-1),ht=e("option",{value:"test"},"Test",-1),vt=e("option",{value:"info"},"Information",-1),yt=e("option",{value:"summary"},"R\xE9sum\xE9 de cours",-1),xt=[gt,ht,vt,yt],Dt=e("label",null,"Mati\xE8re :",-1),wt=["value"],ft=e("label",null,"Title :",-1),kt=e("label",null,"Description :",-1),$t={class:"flex gap-1"},St=["disabled"],J={__name:"TaskForm",setup(q){const n=Y(),d=K({id:n.additionalData.id||null,date:n.additionalData.date||"",promotion:n.additionalData.promotion||"mtu1e",type:n.additionalData.type||"homework",matter:n.additionalData.matter||"",title:n.additionalData.title||"",content:n.additionalData.content||""}),m=K({...d.value}),{result:S}=j(at),{mutate:u,error:c,onDone:D}=L(st,()=>({variables:d.value,update:(r,{data:{task:o}})=>{if(m.value.id){const h=new Date(m.value.date),B=(h.getDay()+6)%7,{year:Z,week:tt}=Q(h),G={query:U,variables:{promotion:m.value.promotion,year:Z,week:tt}},et=r.readQuery(G),I=JSON.parse(JSON.stringify(et));I.week.days[B].tasks=I.week.days[B].tasks.filter(ot=>ot.id!=m.value.id),r.writeQuery({...G,data:I})}const _=new Date(o.date),a=(_.getDay()+6)%7,{year:A,week:C}=Q(_),M={query:U,variables:{promotion:o.promotion,year:A,week:C}},v=r.readQuery(M);if(v){const h=JSON.parse(JSON.stringify(v));h.week.days[a].tasks.push(o),r.writeQuery({...M,data:h})}}}));D(()=>{n.component=!1});const{mutate:E,error:w,onDone:N}=L(nt,()=>({variables:{id:m.value.id},update:r=>{const o=new Date(m.value.date),_=(o.getDay()+6)%7,{year:a,week:A}=Q(o),C={query:U,variables:{promotion:m.value.promotion,year:a,week:A}},M=r.readQuery(C),v=JSON.parse(JSON.stringify(M));v.week.days[_].tasks=v.week.days[_].tasks.filter(h=>h.id!=m.value.id),r.writeQuery({...C,data:v})}}));N(()=>{n.component=!1});const g=K(3);let s;const V=()=>{g.value--,s=setInterval(()=>{g.value--,g.value==0&&clearInterval(s)},1e3)},T=()=>{clearInterval(s),g.value=3};return(r,o)=>{var _;return l(),i("div",lt,[it,t(c)?(l(),i("span",dt,p(t(c).message),1)):b("",!0),t(w)?(l(),i("span",ut,p(t(w).message),1)):b("",!0),pt,y(e("input",{type:"date","onUpdate:modelValue":o[0]||(o[0]=a=>d.value.date=a),class:"p-2 border rounded-sm",onKeyup:o[1]||(o[1]=x((...a)=>t(u)&&t(u)(...a),["enter"]))},null,544),[[O,d.value.date]]),ct,y(e("select",{"onUpdate:modelValue":o[2]||(o[2]=a=>d.value.promotion=a),class:"p-2 bg-white border rounded-sm",onKeyup:o[3]||(o[3]=x((...a)=>t(u)&&t(u)(...a),["enter"]))},_t,544),[[R,d.value.promotion]]),bt,y(e("select",{"onUpdate:modelValue":o[4]||(o[4]=a=>d.value.type=a),class:"p-2 bg-white border rounded-sm",onKeyup:o[5]||(o[5]=x((...a)=>t(u)&&t(u)(...a),["enter"]))},xt,544),[[R,d.value.type]]),Dt,y(e("select",{"onUpdate:modelValue":o[6]||(o[6]=a=>d.value.matter=a),class:"p-2 bg-white border rounded-sm",onKeyup:o[7]||(o[7]=x((...a)=>t(u)&&t(u)(...a),["enter"]))},[(l(!0),i(k,null,$(((_=t(S))==null?void 0:_.matters)||[],a=>(l(),i("option",{value:a.abbr},p(a.name),9,wt))),256))],544),[[R,d.value.matter]]),ft,y(e("input",{type:"text","onUpdate:modelValue":o[8]||(o[8]=a=>d.value.title=a),class:"p-2 border rounded-sm",onKeyup:o[9]||(o[9]=x((...a)=>t(u)&&t(u)(...a),["enter"]))},null,544),[[O,d.value.title]]),kt,y(e("input",{type:"text","onUpdate:modelValue":o[10]||(o[10]=a=>d.value.content=a),class:"p-2 border rounded-sm",onKeyup:o[11]||(o[11]=x((...a)=>t(u)&&t(u)(...a),["enter"]))},null,544),[[O,d.value.content]]),e("div",$t,[e("button",{onClick:o[12]||(o[12]=(...a)=>t(u)&&t(u)(...a)),class:"flex-grow p-2 mt-2 text-white rounded-sm bg-etml hover:opacity-90 active:opacity-80"}," Valider "),d.value.id?(l(),i("button",{key:0,onMouseenter:V,onMouseleave:T,onClick:o[13]||(o[13]=(...a)=>t(E)&&t(E)(...a)),class:"p-2 mt-2 font-bold text-white bg-red-600 rounded-sm hover:opacity-90 active:opacity-80 aspect-square disabled:cursor-not-allowed",disabled:g.value},p(g.value||"\u2A09"),41,St)):b("",!0)])])}}},Et={class:"px-1 text-white bg-orange-700"},Nt={class:"text-2xl font-light"},Tt={class:"ml-2 font-light uppercase text-md"},Ct={class:"float-right text-2xl font-light"},Mt={class:"leading-relaxed border-b border-orange-700"},Ut=e("td",{class:"inline-block w-4 h-4 border border-orange-700 cursor-pointer"},null,-1),Vt={key:0,class:"px-2 font-bold align-top"},At=["colspan"],It={key:1,class:"align-top"},Kt=["onClick"],Qt={__name:"DayPopup",setup(q){const n=Y(),d=P(),m=F();return(S,u)=>(l(),i("div",null,[e("h2",Et,[e("span",Nt,p(t(n).additionalData.day.date.getDate()),1),e("span",Tt,p(t(z)[t(n).additionalData.day.date.getDay()]),1),e("span",Ct,p(t(W)[t(n).additionalData.day.date.getMonth()]),1)]),e("table",null,[(l(!0),i(k,null,$([...t(n).additionalData.day.tasks].sort(t(X)),c=>{var D;return l(),i("tr",Mt,[Ut,c.matter.shortName?(l(),i("td",Vt,p(c.matter.shortName),1)):b("",!0),e("td",{class:"px-2 align-top",colspan:c.matter.shortName?1:2},p(t(H)[c.type].emoji)+" "+p(c.title),9,At),(D=t(d).user)!=null&&D.admin?(l(),i("td",It,[e("button",{onClick:E=>{t(n).component=J,t(n).additionalData={id:c.id,date:c.date,promotion:t(m).params.promotion,type:c.type,matter:c.matter.abbr,title:c.title,content:c.content}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Edit ",8,Kt)])):b("",!0)])}),256))])]))}},Ot={class:"flex flex-col flex-wrap gap-y-4 gap-x-16"},Rt={class:"w-full xl:w-1/2 xl:pr-16"},Jt={class:"text-2xl font-light border-b border-black"},Yt={class:"float-right"},qt=e("div",{class:"w-full border-b border-orange-700"},[e("h2",{class:"inline font-bold text-orange-700 uppercase text-2xs"}," Communications ")],-1),Bt=e("div",{class:"w-full border-b border-orange-700"},"\xA0",-1),Gt=e("div",{class:"w-full border-b border-orange-700"},"\xA0",-1),Lt={class:"w-full xl:w-1/2 xl:pr-16"},Pt={class:"px-1 text-white bg-orange-700"},jt={class:"text-2xl font-light"},Ft={class:"ml-2 font-light uppercase text-md"},zt={key:0,class:"float-right text-2xl font-light"},Wt=e("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"},null,-1),Ht={key:0,class:"inline-block w-20"},Xt=["title"],Zt=["onClick"],te={class:"leading-relaxed border-b border-orange-700"},ee={key:0},oe=["onClick"],ae=["onClick"],se={class:"leading-relaxed border-b border-orange-700"},le={__name:"AgendaPage",setup(q){const n=F(),d=P(),m=Y(),{result:S}=j(U,()=>({promotion:n.params.promotion,year:parseInt(n.params.year),week:parseInt(n.params.week)})),u=5,c=3;return(D,E)=>{var w,N,g;return l(),i("div",Ot,[e("div",Rt,[e("h1",Jt,[f(" Semaine "+p(t(n).params.week)+" ",1),e("span",Yt,p(t(n).params.year),1)]),qt,Bt,Gt]),(l(!0),i(k,null,$(((g=(N=(w=t(S))==null?void 0:w.week)==null?void 0:N.days)==null?void 0:g.map(s=>({...s,strDate:s.date,date:new Date(s.date)})))||[],(s,V)=>{var T;return l(),i("div",Lt,[e("h2",Pt,[e("span",jt,p(s.date.getDate()),1),e("span",Ft,p(t(z)[s.date.getDay()]),1),V==0||s.date.getDate()==1?(l(),i("span",zt,p(t(W)[s.date.getMonth()]),1)):b("",!0)]),e("ul",null,[(l(!0),i(k,null,$([...s.tasks].sort(t(X)).slice(0,(s.date.getDay()?u:c)-1),r=>{var o,_;return l(),i("li",{class:rt(["relative leading-relaxed truncate border-b border-orange-700",{"pr-8":(o=t(d).user)==null?void 0:o.admin}])},[Wt,f(" "+p()+" ",1),r.matter.shortName?(l(),i("strong",Ht,p(r.matter.shortName),1)):b("",!0),f(" "+p(t(H)[r.type].emoji)+" ",1),e("span",{title:r.title},p(r.title),9,Xt),(_=t(d).user)!=null&&_.admin?(l(),i("button",{key:1,onClick:a=>{t(m).component=J,t(m).additionalData={id:r.id,date:r.date,promotion:t(n).params.promotion,type:r.type,matter:r.matter.abbr,title:r.title,content:r.content}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml absolute right-0 my-1"}," Edit ",8,Zt)):b("",!0)],2)}),256)),e("li",te,[s.tasks.length>=(s.date.getDay()?u:c)?(l(),i("span",ee,[f(" + "+p(s.tasks.length+1-(s.date.getDay()?u:c))+" "+p(s.tasks.length+1-(s.date.getDay()?u:c)>=2?"autres \xE9l\xE9ments":"autre \xE9l\xE9ment")+" ",1),e("button",{onClick:r=>{t(m).component=Qt,t(m).additionalData={day:s}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-gray-600"}," Voir ",8,oe)])):b("",!0),(T=t(d).user)!=null&&T.admin?(l(),i("button",{key:1,onClick:r=>{t(m).component=J,t(m).additionalData={date:s.strDate}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Ajouter ",8,ae)):b("",!0),f(" \xA0 ")]),(l(!0),i(k,null,$(Math.max((s.date.getDay()?u:c)-s.tasks.length-1,0),r=>(l(),i("li",se," \xA0 "))),256))])])}),256))])}}};export{le as default};
