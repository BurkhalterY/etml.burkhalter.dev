import{G as rt,a as K,M as lt,D as it,u as z}from"./auth.8b2dd12f.js";import{u as B,r as O,z as W,e as j,B as R,o as r,c as l,b as t,t as d,d as b,w as f,v as J,a as e,f as k,g as Y,F as N,A as T,C as H,D as X,E as Z,G as tt,H as et,h as I,n as F}from"./index.b2aba4ed.js";const dt={class:"flex flex-col gap-2"},ut=e("h2",{class:"text-xl font-bold text-center"},"Devoir",-1),pt={key:0,class:"text-red-500"},ct={key:1,class:"text-red-500"},mt=e("label",null,"Date :",-1),_t=e("label",null,"Classe :",-1),bt=e("option",{value:"mtu1e"},"MTU1E",-1),gt=[bt],ht=e("label",null,"Type :",-1),vt=e("option",{value:"homework"},"Devoir",-1),yt=e("option",{value:"test"},"Test",-1),xt=e("option",{value:"info"},"Information",-1),Dt=e("option",{value:"summary"},"R\xE9sum\xE9 de cours",-1),wt=[vt,yt,xt,Dt],ft=e("label",null,"Mati\xE8re :",-1),kt=["value"],$t=e("label",null,"Title :",-1),St=e("label",null,"Description :",-1),Et={class:"flex gap-1"},Nt=["disabled"],q={__name:"TaskForm",setup(G){const n=B(),i=O({id:n.additionalData.id||null,date:n.additionalData.date||"",promotion:n.additionalData.promotion||"mtu1e",type:n.additionalData.type||"homework",matter:n.additionalData.matter||"",title:n.additionalData.title||"",content:n.additionalData.content||""}),u=O({...i.value}),{result:C}=W(rt),{mutate:p,error:m,onDone:v}=j(lt,()=>({variables:i.value,update:(_,{data:{task:o}})=>{if(u.value.id){const y=new Date(u.value.date),L=(y.getDay()+6)%7,{year:ot,week:at}=R(y),P={query:K,variables:{promotion:u.value.promotion,year:ot,week:at}},st=_.readQuery(P),V=JSON.parse(JSON.stringify(st));V.week.days[L].tasks=V.week.days[L].tasks.filter(nt=>nt.id!=u.value.id),_.writeQuery({...P,data:V})}const h=new Date(o.date),a=(h.getDay()+6)%7,{year:Q,week:U}=R(h),A={query:K,variables:{promotion:o.promotion,year:Q,week:U}},w=_.readQuery(A);if(w){const y=JSON.parse(JSON.stringify(w));y.week.days[a].tasks.push(o),_.writeQuery({...A,data:y})}}}));v(()=>{n.component=!1});const{mutate:x,error:$,onDone:s}=j(it,()=>({variables:{id:u.value.id},update:_=>{const o=new Date(u.value.date),h=(o.getDay()+6)%7,{year:a,week:Q}=R(o),U={query:K,variables:{promotion:u.value.promotion,year:a,week:Q}},A=_.readQuery(U),w=JSON.parse(JSON.stringify(A));w.week.days[h].tasks=w.week.days[h].tasks.filter(y=>y.id!=u.value.id),_.writeQuery({...U,data:w})}}));s(()=>{n.component=!1});const g=O(3);let D;const c=()=>{g.value--,D=setInterval(()=>{g.value--,g.value==0&&clearInterval(D)},1e3)},M=()=>{clearInterval(D),g.value=3};return(_,o)=>{var h;return r(),l("div",dt,[ut,t(m)?(r(),l("span",pt,d(t(m).message),1)):b("",!0),t($)?(r(),l("span",ct,d(t($).message),1)):b("",!0),mt,f(e("input",{type:"date","onUpdate:modelValue":o[0]||(o[0]=a=>i.value.date=a),class:"p-2 border rounded-sm",onKeyup:o[1]||(o[1]=k((...a)=>t(p)&&t(p)(...a),["enter"]))},null,544),[[J,i.value.date]]),_t,f(e("select",{"onUpdate:modelValue":o[2]||(o[2]=a=>i.value.promotion=a),class:"p-2 bg-white border rounded-sm",onKeyup:o[3]||(o[3]=k((...a)=>t(p)&&t(p)(...a),["enter"]))},gt,544),[[Y,i.value.promotion]]),ht,f(e("select",{"onUpdate:modelValue":o[4]||(o[4]=a=>i.value.type=a),class:"p-2 bg-white border rounded-sm",onKeyup:o[5]||(o[5]=k((...a)=>t(p)&&t(p)(...a),["enter"]))},wt,544),[[Y,i.value.type]]),ft,f(e("select",{"onUpdate:modelValue":o[6]||(o[6]=a=>i.value.matter=a),class:"p-2 bg-white border rounded-sm",onKeyup:o[7]||(o[7]=k((...a)=>t(p)&&t(p)(...a),["enter"]))},[(r(!0),l(N,null,T(((h=t(C))==null?void 0:h.matters)||[],a=>(r(),l("option",{value:a.abbr},d(a.name),9,kt))),256))],544),[[Y,i.value.matter]]),$t,f(e("input",{type:"text","onUpdate:modelValue":o[8]||(o[8]=a=>i.value.title=a),class:"p-2 border rounded-sm",onKeyup:o[9]||(o[9]=k((...a)=>t(p)&&t(p)(...a),["enter"]))},null,544),[[J,i.value.title]]),St,f(e("input",{type:"text","onUpdate:modelValue":o[10]||(o[10]=a=>i.value.content=a),class:"p-2 border rounded-sm",onKeyup:o[11]||(o[11]=k((...a)=>t(p)&&t(p)(...a),["enter"]))},null,544),[[J,i.value.content]]),e("div",Et,[e("button",{onClick:o[12]||(o[12]=(...a)=>t(p)&&t(p)(...a)),class:"flex-grow p-2 mt-2 text-white rounded-sm bg-etml hover:opacity-90 active:opacity-80"}," Valider "),i.value.id?(r(),l("button",{key:0,onMouseenter:c,onMouseleave:M,onClick:o[13]||(o[13]=(...a)=>t(x)&&t(x)(...a)),class:"p-2 mt-2 font-bold text-white bg-red-600 rounded-sm hover:opacity-90 active:opacity-80 aspect-square disabled:cursor-not-allowed",disabled:g.value},d(g.value||"\u2A09"),41,Nt)):b("",!0)])])}}},Tt={class:"px-1 text-white bg-orange-700"},Ct={class:"text-2xl font-light"},Mt={class:"ml-2 font-light uppercase text-md"},Ut={class:"float-right text-2xl font-light"},At={class:"leading-relaxed border-b border-orange-700"},It=e("td",{class:"inline-block w-4 h-4 border border-orange-700 cursor-pointer"},null,-1),Kt={key:0,class:"px-2 font-bold align-top"},Qt=["colspan"],Vt={key:1,class:"align-top"},Ot=["onClick"],Rt={__name:"DayPopup",setup(G){const n=B(),i=z(),u=H();return(C,p)=>(r(),l("div",null,[e("h2",Tt,[e("span",Ct,d(t(n).additionalData.day.date.getDate()),1),e("span",Mt,d(t(X)[t(n).additionalData.day.date.getDay()]),1),e("span",Ut,d(t(Z)[t(n).additionalData.day.date.getMonth()]),1)]),e("table",null,[(r(!0),l(N,null,T([...t(n).additionalData.day.tasks].sort(t(et)),m=>{var v;return r(),l("tr",At,[It,m.matter.shortName?(r(),l("td",Kt,d(m.matter.shortName),1)):b("",!0),e("td",{class:"px-2 align-top",colspan:m.matter.shortName?1:2},d(t(tt)[m.type].emoji)+" "+d(m.title),9,Qt),(v=t(i).user)!=null&&v.admin?(r(),l("td",Vt,[e("button",{onClick:x=>{t(n).component=q,t(n).additionalData={id:m.id,date:m.date,promotion:t(u).params.promotion,type:m.type,matter:m.matter.abbr,title:m.title,content:m.content}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Edit ",8,Ot)])):b("",!0)])}),256))])]))}},Jt={class:"flex flex-col flex-wrap gap-y-4 gap-x-16"},Yt={class:"w-full xl:w-1/2 xl:pr-16"},qt={class:"text-2xl font-light border-b border-black"},Bt={class:"float-right"},Gt=e("div",{class:"w-full border-b border-orange-700"},[e("h2",{class:"inline font-bold text-orange-700 uppercase text-2xs"}," Communications ")],-1),Lt=e("div",{class:"w-full border-b border-orange-700"},"\xA0",-1),Pt=e("div",{class:"w-full border-b border-orange-700"},"\xA0",-1),jt={class:"w-full xl:w-1/2 xl:pr-16"},Ft=["onClick"],zt={class:"text-2xl font-light"},Wt={class:"ml-2 font-light uppercase text-md"},Ht={key:0,class:"float-right text-2xl font-light"},Xt=e("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"},null,-1),Zt={key:0,class:"inline-block w-20"},te=["title"],ee=["onClick"],oe={class:"leading-relaxed border-b border-orange-700"},ae={key:0},se=["onClick"],ne={class:"leading-relaxed border-b border-orange-700"},S=5,E=3,ie={__name:"AgendaPage",setup(G){const n=H(),i=z(),u=B(),{result:C}=W(K,()=>({promotion:n.params.promotion,year:parseInt(n.params.year),week:parseInt(n.params.week)}));return(p,m)=>{var v,x,$;return r(),l("div",Jt,[e("div",Yt,[e("h1",qt,[I(" Semaine "+d(t(n).params.week)+" ",1),e("span",Bt,d(t(n).params.year),1)]),Gt,Lt,Pt]),(r(!0),l(N,null,T((($=(x=(v=t(C))==null?void 0:v.week)==null?void 0:x.days)==null?void 0:$.map(s=>({...s,strDate:s.date,date:new Date(s.date)})))||[],(s,g)=>{var D;return r(),l("div",jt,[e("h2",{class:F(["px-1 text-white bg-orange-700",{"cursor-pointer":s.tasks.length}]),onClick:c=>s.tasks.length?[t(u).component=Rt,t(u).additionalData={day:s}]:[]},[e("span",zt,d(s.date.getDate()),1),e("span",Wt,d(t(X)[s.date.getDay()]),1),g==0||s.date.getDate()==1?(r(),l("span",Ht,d(t(Z)[s.date.getMonth()]),1)):b("",!0)],10,Ft),e("ul",null,[(r(!0),l(N,null,T([...s.tasks].sort(t(et)).slice(0,(s.date.getDay()?S:E)-1),c=>{var M,_;return r(),l("li",{class:F(["relative leading-relaxed truncate border-b border-orange-700",{"pr-8":(M=t(i).user)==null?void 0:M.admin}])},[Xt,I(" "+d()+" ",1),c.matter.shortName?(r(),l("strong",Zt,d(c.matter.shortName),1)):b("",!0),I(" "+d(t(tt)[c.type].emoji)+" ",1),e("span",{title:c.title},d(c.title),9,te),(_=t(i).user)!=null&&_.admin?(r(),l("button",{key:1,onClick:o=>{t(u).component=q,t(u).additionalData={id:c.id,date:c.date,promotion:t(n).params.promotion,type:c.type,matter:c.matter.abbr,title:c.title,content:c.content}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml absolute right-0 my-1"}," Edit ",8,ee)):b("",!0)],2)}),256)),e("li",oe,[s.tasks.length>=(s.date.getDay()?S:E)?(r(),l("span",ae," + "+d(s.tasks.length+1-(s.date.getDay()?S:E))+" "+d(s.tasks.length+1-(s.date.getDay()?S:E)>=2?"autres \xE9l\xE9ments":"autre \xE9l\xE9ment"),1)):b("",!0),(D=t(i).user)!=null&&D.admin?(r(),l("button",{key:1,onClick:c=>{t(u).component=q,t(u).additionalData={date:s.strDate}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Ajouter ",8,se)):b("",!0),I(" \xA0 ")]),(r(!0),l(N,null,T(Math.max((s.date.getDay()?S:E)-s.tasks.length-1,0),c=>(r(),l("li",ne," \xA0 "))),256))])])}),256))])}}};export{ie as default};
