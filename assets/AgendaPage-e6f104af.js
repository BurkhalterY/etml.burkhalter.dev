import{u as G,f as z,r as Q,m as ae,g as ee,p as B,o as n,a as r,b as e,t as l,e as b,w as S,v as te,d as t,h as E,q as P,F as h,l as C,s as se,x as ne,y as re,z as le,A as be,c as j,i as k,B as F,C as K,T as L,D as ge,E as ve,n as he}from"./index-42006f00.js";import{G as ye,a as O,M as xe,D as ke,u as ie}from"./auth-b5000bae.js";const we={class:"flex flex-col gap-2"},fe=t("h2",{class:"text-xl font-semibold text-center"},"Devoir",-1),De={key:0,class:"text-red-500"},$e={key:1,class:"text-red-500"},Se=t("label",null,"Date :",-1),Ee=t("label",null,"Classe :",-1),Ne=t("option",{value:"mtu1e"},"MTU1E",-1),Te=t("option",{value:"mtu2e"},"MTU2E",-1),Ce=[Ne,Te],Me=t("label",null,"Type :",-1),Ae=t("option",{value:"homework"},"Devoir",-1),Ue=t("option",{value:"test"},"Test",-1),Ve=t("option",{value:"info"},"Information",-1),Ie=[Ae,Ue,Ve],Qe=t("label",null,"Matière :",-1),Ke=["value"],Le=t("label",null,"Titre :",-1),Oe={class:"flex gap-1"},Re=["disabled"],Je=["disabled"],de={__name:"TaskForm",setup(W){var H;const i=G(),y=z(),d=Q({...y.additionalData}),m=Q(((H=d.value.matter)==null?void 0:H.abbr)??""),_=Q({...d.value}),{result:c}=ae(ye),{mutate:u,loading:R,error:M,onDone:w}=ee(xe,()=>({variables:{...d.value,matter:m.value},update:(g,{data:{task:a}})=>{if(_.value.id){const x=new Date(_.value.date),X=(x.getDay()+6)%7,{year:ce,week:pe}=B(x),Z={query:O,variables:{promotion:_.value.promotion,year:ce,week:pe}},me=g.readQuery(Z),q=JSON.parse(JSON.stringify(me));q.week.days[X].tasks=q.week.days[X].tasks.filter(_e=>_e.id!=_.value.id),g.writeQuery({...Z,data:q})}const v=new Date(a.date),s=(v.getDay()+6)%7,{year:Y,week:V}=B(v),I={query:O,variables:{promotion:a.promotion,year:Y,week:V}},D=g.readQuery(I);if(D){const x=JSON.parse(JSON.stringify(D));x.week.days[s].tasks.push(a),g.writeQuery({...I,data:x})}}}));w(()=>{y.component=null});const{mutate:J,loading:A,error:$,onDone:U}=ee(ke,()=>({variables:{id:_.value.id},update:g=>{const a=new Date(_.value.date),v=(a.getDay()+6)%7,{year:s,week:Y}=B(a),V={query:O,variables:{promotion:i.params.promotion,year:s,week:Y}},I=g.readQuery(V),D=JSON.parse(JSON.stringify(I));D.week.days[v].tasks=D.week.days[v].tasks.filter(x=>x.id!=_.value.id),g.writeQuery({...V,data:D})}}));U(()=>{y.component=null});const o=Q(3);let f;const p=()=>{o.value--,f=setInterval(()=>{o.value--,o.value==0&&clearInterval(f)},1e3)},ue=()=>{clearInterval(f),o.value=3};return(g,a)=>{var v;return n(),r("div",we,[fe,e(M)?(n(),r("span",De,l(e(M).message),1)):b("",!0),e($)?(n(),r("span",$e,l(e($).message),1)):b("",!0),Se,S(t("input",{type:"date","onUpdate:modelValue":a[0]||(a[0]=s=>d.value.date=s),onKeyup:a[1]||(a[1]=E((...s)=>e(u)&&e(u)(...s),["enter"])),class:"p-2 border rounded-sm"},null,544),[[te,d.value.date]]),Ee,S(t("select",{"onUpdate:modelValue":a[2]||(a[2]=s=>d.value.promotion=s),onKeyup:a[3]||(a[3]=E((...s)=>e(u)&&e(u)(...s),["enter"])),class:"p-2 bg-white border rounded-sm"},Ce,544),[[P,d.value.promotion]]),Me,S(t("select",{"onUpdate:modelValue":a[4]||(a[4]=s=>d.value.type=s),onKeyup:a[5]||(a[5]=E((...s)=>e(u)&&e(u)(...s),["enter"])),class:"p-2 bg-white border rounded-sm"},Ie,544),[[P,d.value.type]]),Qe,S(t("select",{"onUpdate:modelValue":a[6]||(a[6]=s=>m.value=s),onKeyup:a[7]||(a[7]=E((...s)=>e(u)&&e(u)(...s),["enter"])),class:"p-2 bg-white border rounded-sm"},[(n(!0),r(h,null,C(((v=e(c))==null?void 0:v.matters)||[],s=>(n(),r("option",{key:s.abbr,value:s.abbr},l(s.name),9,Ke))),128))],544),[[P,m.value]]),Le,S(t("input",{type:"text","onUpdate:modelValue":a[8]||(a[8]=s=>d.value.title=s),onKeyup:a[9]||(a[9]=E((...s)=>e(u)&&e(u)(...s),["enter"])),class:"p-2 border rounded-sm"},null,544),[[te,d.value.title]]),t("div",Oe,[t("button",{onClick:a[10]||(a[10]=(...s)=>e(u)&&e(u)(...s)),class:"flex-grow p-2 mt-2 text-white rounded-sm bg-etml hover:opacity-90 active:opacity-80",disabled:e(R)}," Valider ",8,Re),d.value.id?(n(),r("button",{key:0,onMouseenter:p,onMouseleave:ue,onClick:a[11]||(a[11]=(...s)=>e(J)&&e(J)(...s)),class:"p-2 mt-2 font-semibold text-white bg-red-600 rounded-sm hover:opacity-90 active:opacity-80 aspect-square disabled:cursor-not-allowed",disabled:o.value||e(A)},l(o.value||"⨉"),41,Je)):b("",!0)])])}}},Ye={class:"px-1 text-white bg-orange-700"},qe={class:"text-2xl font-light"},Be={class:"ml-2 font-light uppercase text-md"},Pe={class:"float-right text-2xl font-light"},je=t("td",{class:"px-0 py-1 align-top"},[t("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"})],-1),Fe={key:0,class:"px-2 py-1 font-semibold align-top"},Ge=["colspan"],ze={key:1,class:"py-1 align-top"},We=["onClick"],oe={__name:"DayPopup",setup(W){const i=z(),y=ie(),d=G();return(m,_)=>(n(),r("div",null,[t("h2",Ye,[t("span",qe,l(e(i).additionalData.day.date.getDate()),1),t("span",Be,l(e(se)[e(i).additionalData.day.date.getDay()]),1),t("span",Pe,l(e(ne)[e(i).additionalData.day.date.getMonth()]),1)]),t("table",null,[(n(!0),r(h,null,C([...e(i).additionalData.day.tasks].sort(e(le)),c=>(n(),r("tr",{key:c.id,class:"leading-snug border-b border-orange-700"},[je,c.matter.shortName?(n(),r("td",Fe,l(c.matter.abbr=="ecdr"&&e(d).params.promotion=="mtu2e"?"Droit":c.matter.shortName),1)):b("",!0),t("td",{class:"px-2 py-1 align-top",colspan:c.matter.shortName?1:2},l(e(re)[c.type].emoji)+" "+l(c.title),9,Ge),e(y).isAdmin?(n(),r("td",ze,[t("button",{onClick:u=>{e(i).component=de,e(i).additionalData=c},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Éditer ",8,We)])):b("",!0)]))),128))])]))}},He={class:"flex flex-col flex-wrap gap-y-4 gap-x-16"},Xe={class:"w-full xl:w-1/2 xl:pr-16"},Ze={class:"text-2xl font-light border-b border-black"},et={class:"float-right"},tt=t("div",{class:"w-full border-b border-orange-700"},[t("h2",{class:"inline font-black text-orange-700 uppercase text-2xs"}," Communications ")],-1),ot={class:"w-full border-b border-orange-700"},at=t("div",{class:"text-center text-red-500 transition-opacity"}," Aucune connexion Internet ! ",-1),st=t("div",{class:"text-center text-red-500 transition-opacity"}," Une erreur est survenue ",-1),nt={class:"w-full border-b border-orange-700"},rt=t("div",{class:"text-center text-red-500 transition-opacity"}," Les données peuvent ne pas être à jour. ",-1),lt={class:"transition-opacity"},it=["onClick"],dt={class:"text-2xl font-light"},ut={class:"ml-2 font-light uppercase text-md"},ct={key:0,class:"float-right text-2xl font-light"},pt=["title"],mt=t("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"},null,-1),_t={key:0,class:"inline-block w-20 font-semibold"},bt={class:"leading-relaxed border-b border-orange-700"},gt=["onClick"],vt=["onClick"],N=5,T=3,xt={__name:"AgendaPage",setup(W){const i=G(),y=be(),d=ie(),m=z(),_=j(()=>navigator.onLine),c=j(()=>{const w=parseInt(i.params.week);return w>26&&w<34&&y.push({name:i.name,params:{...i.params,week:34}}),w}),u=j(()=>ge(i.params.promotion,c.value)),{result:R,error:M}=ae(O,()=>({promotion:i.params.promotion,year:u.value,week:c.value}),{fetchPolicy:"cache-and-network"});return(w,J)=>{var A,$,U;return n(),r("div",He,[t("div",Xe,[t("h1",Ze,[k(" Semaine "+l(c.value)+" ",1),t("span",et,l(u.value),1)]),tt,t("div",ot,[_.value?e(M)?(n(),F(L,{key:1,appear:""},{default:K(()=>[st]),_:1})):(n(),r(h,{key:2},[k(" ")],64)):(n(),F(L,{key:0,appear:""},{default:K(()=>[at]),_:1}))]),t("div",nt,[_.value?(n(),r(h,{key:1},[k(" ")],64)):(n(),F(L,{key:0,appear:""},{default:K(()=>[rt]),_:1}))])]),(n(!0),r(h,null,C(((U=($=(A=e(R))==null?void 0:A.week)==null?void 0:$.days)==null?void 0:U.map(o=>({...o,strDate:o.date,date:new Date(o.date)})))||[],(o,f)=>(n(),r("div",{key:f,class:"w-full xl:w-1/2 xl:pr-16"},[ve(L,{appear:""},{default:K(()=>[t("div",lt,[t("h2",{onClick:p=>o.tasks.length?[e(m).component=oe,e(m).additionalData={day:o}]:[],class:he(["px-1 text-white bg-orange-700",{"cursor-pointer":o.tasks.length}])},[t("span",dt,l(o.date.getDate()),1),t("span",ut,l(e(se)[o.date.getDay()]),1),f==0||o.date.getDate()==1?(n(),r("span",ct,l(e(ne)[o.date.getMonth()]),1)):b("",!0)],10,it),t("ul",null,[(n(!0),r(h,null,C([...o.tasks].sort(e(le)).slice(0,(o.date.getDay()?N:T)-1),p=>(n(),r("li",{key:p.id,class:"relative leading-relaxed truncate border-b border-orange-700",title:p.title},[mt,k(" "+l()+" ",1),p.matter.shortName?(n(),r("span",_t,l(p.matter.abbr=="ecdr"&&e(i).params.promotion=="mtu2e"?"Droit":p.matter.shortName),1)):b("",!0),k(" "+l(e(re)[p.type].emoji)+" "+l(p.title),1)],8,pt))),128)),t("li",bt,[o.tasks.length>=(o.date.getDay()?N:T)?(n(),r(h,{key:0},[k(" + "+l(o.tasks.length+1-(o.date.getDay()?N:T))+" "+l(o.tasks.length+1-(o.date.getDay()?N:T)>=2?"autres éléments":"autre élément")+" ",1),t("button",{onClick:p=>o.tasks.length?[e(m).component=oe,e(m).additionalData={day:o}]:[],class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Voir ",8,gt)],64)):b("",!0),e(d).isAdmin?(n(),r("button",{key:1,onClick:p=>{e(m).component=de,e(m).additionalData={date:o.strDate,promotion:e(i).params.promotion,matter:"",type:"homework",title:""}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Ajouter ",8,vt)):b("",!0),k("   ")]),(n(!0),r(h,null,C(Math.max((o.date.getDay()?N:T)-o.tasks.length-1,0),p=>(n(),r("li",{key:p,class:"leading-relaxed border-b border-orange-700"},"   "))),128))])])]),_:2},1024)]))),128))])}}};export{xt as default};
