import{a as ue,b as K,M as ce,D as pe,u as ee}from"./auth-9a429df6.js";import{u as q,d as B,r as Q,p as te,e as W,q as R,o as n,a as r,f as e,t as l,g as b,w as $,v as H,b as t,h as S,s as J,F as T,m as C,x as oe,y as se,z as ae,A as ne,B as me,c as X,i as I,C as _e,n as Z}from"./index-2a1403a0.js";const be={class:"flex flex-col gap-2"},he=t("h2",{class:"text-xl font-bold text-center"},"Devoir",-1),ge={key:0,class:"text-red-500"},ve={key:1,class:"text-red-500"},xe=t("label",null,"Date :",-1),ye=t("label",null,"Classe :",-1),we=t("option",{value:"mtu1e"},"MTU1E",-1),De=t("option",{value:"mtu2e"},"MTU2E",-1),fe=[we,De],ke=t("label",null,"Type :",-1),$e=t("option",{value:"homework"},"Devoir",-1),Se=t("option",{value:"test"},"Test",-1),Ee=t("option",{value:"info"},"Information",-1),Ne=[$e,Se,Ee],Te=t("label",null,"Matière :",-1),Ce=["value"],Me=t("label",null,"Titre :",-1),Ue={class:"flex gap-1"},Ae=["disabled"],Y={__name:"TaskForm",setup(L){var F;const d=q(),v=B(),i=Q({...v.additionalData}),m=Q(((F=i.value.matter)==null?void 0:F.abbr)??""),_=Q({...i.value}),{result:c}=te(ue),{mutate:u,error:x,onDone:P}=W(ce,()=>({variables:{...i.value,matter:m.value},update:(h,{data:{task:o}})=>{if(_.value.id){const y=new Date(_.value.date),z=(y.getDay()+6)%7,{year:re,week:le}=R(y),G={query:K,variables:{promotion:d.params.promotion,year:re,week:le}},ie=h.readQuery(G),O=JSON.parse(JSON.stringify(ie));O.week.days[z].tasks=O.week.days[z].tasks.filter(de=>de.id!=_.value.id),h.writeQuery({...G,data:O})}const g=new Date(o.date),s=(g.getDay()+6)%7,{year:V,week:U}=R(g),A={query:K,variables:{promotion:d.params.promotion,year:V,week:U}},w=h.readQuery(A);if(w){const y=JSON.parse(JSON.stringify(w));y.week.days[s].tasks.push(o),h.writeQuery({...A,data:y})}}}));P(()=>{v.component=!1});const{mutate:D,error:f,onDone:M}=W(pe,()=>({variables:{id:_.value.id},update:h=>{const o=new Date(_.value.date),g=(o.getDay()+6)%7,{year:s,week:V}=R(o),U={query:K,variables:{promotion:d.params.promotion,year:s,week:V}},A=h.readQuery(U),w=JSON.parse(JSON.stringify(A));w.week.days[g].tasks=w.week.days[g].tasks.filter(y=>y.id!=_.value.id),h.writeQuery({...U,data:w})}}));M(()=>{v.component=!1});const a=Q(3);let k;const p=()=>{a.value--,k=setInterval(()=>{a.value--,a.value==0&&clearInterval(k)},1e3)},j=()=>{clearInterval(k),a.value=3};return(h,o)=>{var g;return n(),r("div",be,[he,e(x)?(n(),r("span",ge,l(e(x).message),1)):b("",!0),e(f)?(n(),r("span",ve,l(e(f).message),1)):b("",!0),xe,$(t("input",{type:"date","onUpdate:modelValue":o[0]||(o[0]=s=>i.value.date=s),class:"p-2 border rounded-sm",onKeyup:o[1]||(o[1]=S((...s)=>e(u)&&e(u)(...s),["enter"]))},null,544),[[H,i.value.date]]),ye,$(t("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>i.value.promotion=s),class:"p-2 bg-white border rounded-sm",onKeyup:o[3]||(o[3]=S((...s)=>e(u)&&e(u)(...s),["enter"]))},fe,544),[[J,i.value.promotion]]),ke,$(t("select",{"onUpdate:modelValue":o[4]||(o[4]=s=>i.value.type=s),class:"p-2 bg-white border rounded-sm",onKeyup:o[5]||(o[5]=S((...s)=>e(u)&&e(u)(...s),["enter"]))},Ne,544),[[J,i.value.type]]),Te,$(t("select",{"onUpdate:modelValue":o[6]||(o[6]=s=>m.value=s),class:"p-2 bg-white border rounded-sm",onKeyup:o[7]||(o[7]=S((...s)=>e(u)&&e(u)(...s),["enter"]))},[(n(!0),r(T,null,C(((g=e(c))==null?void 0:g.matters)||[],s=>(n(),r("option",{value:s.abbr},l(s.name),9,Ce))),256))],544),[[J,m.value]]),Me,$(t("input",{type:"text","onUpdate:modelValue":o[8]||(o[8]=s=>i.value.title=s),class:"p-2 border rounded-sm",onKeyup:o[9]||(o[9]=S((...s)=>e(u)&&e(u)(...s),["enter"]))},null,544),[[H,i.value.title]]),t("div",Ue,[t("button",{onClick:o[10]||(o[10]=(...s)=>e(u)&&e(u)(...s)),class:"flex-grow p-2 mt-2 text-white rounded-sm bg-etml hover:opacity-90 active:opacity-80"}," Valider "),i.value.id?(n(),r("button",{key:0,onMouseenter:p,onMouseleave:j,onClick:o[11]||(o[11]=(...s)=>e(D)&&e(D)(...s)),class:"p-2 mt-2 font-bold text-white bg-red-600 rounded-sm hover:opacity-90 active:opacity-80 aspect-square disabled:cursor-not-allowed",disabled:a.value},l(a.value||"⨉"),41,Ae)):b("",!0)])])}}},Qe={class:"px-1 text-white bg-orange-700"},Ie={class:"text-2xl font-light"},Ke={class:"ml-2 font-light uppercase text-md"},Ve={class:"float-right text-2xl font-light"},Oe={class:"leading-relaxed border-b border-orange-700"},Re=t("td",{class:"inline-block w-4 h-4 border border-orange-700 cursor-pointer"},null,-1),Je={key:0,class:"px-2 font-bold align-top"},Ye=["colspan"],qe={key:1,class:"align-top"},Be=["onClick"],Le={__name:"DayPopup",setup(L){const d=B(),v=ee(),i=q();return(m,_)=>(n(),r("div",null,[t("h2",Qe,[t("span",Ie,l(e(d).additionalData.day.date.getDate()),1),t("span",Ke,l(e(oe)[e(d).additionalData.day.date.getDay()]),1),t("span",Ve,l(e(se)[e(d).additionalData.day.date.getMonth()]),1)]),t("table",null,[(n(!0),r(T,null,C([...e(d).additionalData.day.tasks].sort(e(ne)),c=>(n(),r("tr",Oe,[Re,c.matter.shortName?(n(),r("td",Je,l(c.matter.abbr=="ecdr"&&e(i).params.promotion=="mtu2e"?"Droit":c.matter.shortName),1)):b("",!0),t("td",{class:"px-2 align-top",colspan:c.matter.shortName?1:2},l(e(ae)[c.type].emoji)+" "+l(c.title),9,Ye),e(v).admin?(n(),r("td",qe,[t("button",{onClick:u=>{e(d).component=Y,e(d).additionalData=c},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Editer ",8,Be)])):b("",!0)]))),256))])]))}},Pe={class:"flex flex-col flex-wrap gap-y-4 gap-x-16"},je={class:"w-full xl:w-1/2 xl:pr-16"},Fe={class:"text-2xl font-light border-b border-black"},ze={class:"float-right"},Ge=t("div",{class:"w-full border-b border-orange-700"},[t("h2",{class:"inline font-bold text-orange-700 uppercase text-2xs"}," Communications ")],-1),We=t("div",{class:"w-full border-b border-orange-700"}," ",-1),He=t("div",{class:"w-full border-b border-orange-700"}," ",-1),Xe={class:"w-full xl:w-1/2 xl:pr-16"},Ze=["onClick"],et={class:"text-2xl font-light"},tt={class:"ml-2 font-light uppercase text-md"},ot={key:0,class:"float-right text-2xl font-light"},st=t("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"},null,-1),at={key:0,class:"inline-block w-20"},nt=["title"],rt=["onClick"],lt={class:"leading-relaxed border-b border-orange-700"},it={key:0},dt=["onClick"],ut={class:"leading-relaxed border-b border-orange-700"},E=5,N=3,mt={__name:"AgendaPage",setup(L){const d=q(),v=me(),i=ee(),m=B(),_=X(()=>{const x=parseInt(d.params.week);return x>26&&x<34&&v.push({name:d.name,params:{...d.params,week:34}}),x}),c=X(()=>_e(d.params.promotion,_.value)),{result:u}=te(K,()=>({promotion:d.params.promotion,year:c.value,week:_.value}));return(x,P)=>{var D,f,M;return n(),r("div",Pe,[t("div",je,[t("h1",Fe,[I(" Semaine "+l(_.value)+" ",1),t("span",ze,l(c.value),1)]),Ge,We,He]),(n(!0),r(T,null,C(((M=(f=(D=e(u))==null?void 0:D.week)==null?void 0:f.days)==null?void 0:M.map(a=>({...a,strDate:a.date,date:new Date(a.date)})))||[],(a,k)=>(n(),r("div",Xe,[t("h2",{class:Z(["px-1 text-white bg-orange-700",{"cursor-pointer":a.tasks.length}]),onClick:p=>a.tasks.length?[e(m).component=Le,e(m).additionalData={day:a}]:[]},[t("span",et,l(a.date.getDate()),1),t("span",tt,l(e(oe)[a.date.getDay()]),1),k==0||a.date.getDate()==1?(n(),r("span",ot,l(e(se)[a.date.getMonth()]),1)):b("",!0)],10,Ze),t("ul",null,[(n(!0),r(T,null,C([...a.tasks].sort(e(ne)).slice(0,(a.date.getDay()?E:N)-1),p=>(n(),r("li",{class:Z(["relative leading-relaxed truncate border-b border-orange-700",{"pr-8":e(i).admin}])},[st,I(" "+l()+" ",1),p.matter.shortName?(n(),r("strong",at,l(p.matter.abbr=="ecdr"&&e(d).params.promotion=="mtu2e"?"Droit":p.matter.shortName),1)):b("",!0),I(" "+l(e(ae)[p.type].emoji)+" ",1),t("span",{title:p.title},l(p.title),9,nt),e(i).admin?(n(),r("button",{key:1,onClick:j=>{e(m).component=Y,e(m).additionalData=p},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml absolute right-0 my-1"}," Éditer ",8,rt)):b("",!0)],2))),256)),t("li",lt,[a.tasks.length>=(a.date.getDay()?E:N)?(n(),r("span",it," + "+l(a.tasks.length+1-(a.date.getDay()?E:N))+" "+l(a.tasks.length+1-(a.date.getDay()?E:N)>=2?"autres éléments":"autre élément"),1)):b("",!0),e(i).admin?(n(),r("button",{key:1,onClick:p=>{e(m).component=Y,e(m).additionalData={date:a.strDate,promotion:"mtu2e",matter:"",type:"homework",title:""}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Ajouter ",8,dt)):b("",!0),I("   ")]),(n(!0),r(T,null,C(Math.max((a.date.getDay()?E:N)-a.tasks.length-1,0),p=>(n(),r("li",ut,"   "))),256))])]))),256))])}}};export{mt as default};
