import{u as q,d as B,r as V,m as Z,e as z,p as J,o as n,a as r,f as e,t as l,g,w as E,v as W,b as t,h as N,q as Y,F as k,l as M,s as ee,x as te,y as oe,z as se,A as pe,c as H,i as f,B as me,C as _e,T as ge,D as be,n as he}from"./index-79c60dc7.js";import{G as ve,a as I,M as xe,D as ye,u as ae}from"./auth-79bac999.js";const we={class:"flex flex-col gap-2"},ke=t("h2",{class:"text-xl font-semibold text-center"},"Devoir",-1),De={key:0,class:"text-red-500"},fe={key:1,class:"text-red-500"},$e=t("label",null,"Date :",-1),Se=t("label",null,"Classe :",-1),Ee=t("option",{value:"mtu1e"},"MTU1E",-1),Ne=t("option",{value:"mtu2e"},"MTU2E",-1),Te=[Ee,Ne],Ce=t("label",null,"Type :",-1),Me=t("option",{value:"homework"},"Devoir",-1),Ue=t("option",{value:"test"},"Test",-1),Ae=t("option",{value:"info"},"Information",-1),Qe=[Me,Ue,Ae],Ve=t("label",null,"Matière :",-1),Ie=["value"],Ke=t("label",null,"Titre :",-1),Oe={class:"flex gap-1"},Re=["disabled"],Je=["disabled"],ne={__name:"TaskForm",setup(L){var j;const i=q(),x=B(),d=V({...x.additionalData}),_=V(((j=d.value.matter)==null?void 0:j.abbr)??""),p=V({...d.value}),{result:m}=Z(ve),{mutate:u,loading:K,error:y,onDone:P}=z(xe,()=>({variables:{...d.value,matter:_.value},update:(h,{data:{task:o}})=>{if(p.value.id){const w=new Date(p.value.date),F=(w.getDay()+6)%7,{year:ie,week:de}=J(w),G={query:I,variables:{promotion:p.value.promotion,year:ie,week:de}},ue=h.readQuery(G),R=JSON.parse(JSON.stringify(ue));R.week.days[F].tasks=R.week.days[F].tasks.filter(ce=>ce.id!=p.value.id),h.writeQuery({...G,data:R})}const v=new Date(o.date),s=(v.getDay()+6)%7,{year:O,week:A}=J(v),Q={query:I,variables:{promotion:o.promotion,year:O,week:A}},D=h.readQuery(Q);if(D){const w=JSON.parse(JSON.stringify(D));w.week.days[s].tasks.push(o),h.writeQuery({...Q,data:w})}}}));P(()=>{x.component=null});const{mutate:$,loading:U,error:S,onDone:a}=z(ye,()=>({variables:{id:p.value.id},update:h=>{const o=new Date(p.value.date),v=(o.getDay()+6)%7,{year:s,week:O}=J(o),A={query:I,variables:{promotion:i.params.promotion,year:s,week:O}},Q=h.readQuery(A),D=JSON.parse(JSON.stringify(Q));D.week.days[v].tasks=D.week.days[v].tasks.filter(w=>w.id!=p.value.id),h.writeQuery({...A,data:D})}}));a(()=>{x.component=null});const b=V(3);let c;const re=()=>{b.value--,c=setInterval(()=>{b.value--,b.value==0&&clearInterval(c)},1e3)},le=()=>{clearInterval(c),b.value=3};return(h,o)=>{var v;return n(),r("div",we,[ke,e(y)?(n(),r("span",De,l(e(y).message),1)):g("",!0),e(S)?(n(),r("span",fe,l(e(S).message),1)):g("",!0),$e,E(t("input",{type:"date","onUpdate:modelValue":o[0]||(o[0]=s=>d.value.date=s),class:"p-2 border rounded-sm",onKeyup:o[1]||(o[1]=N((...s)=>e(u)&&e(u)(...s),["enter"]))},null,544),[[W,d.value.date]]),Se,E(t("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>d.value.promotion=s),class:"p-2 bg-white border rounded-sm",onKeyup:o[3]||(o[3]=N((...s)=>e(u)&&e(u)(...s),["enter"]))},Te,544),[[Y,d.value.promotion]]),Ce,E(t("select",{"onUpdate:modelValue":o[4]||(o[4]=s=>d.value.type=s),class:"p-2 bg-white border rounded-sm",onKeyup:o[5]||(o[5]=N((...s)=>e(u)&&e(u)(...s),["enter"]))},Qe,544),[[Y,d.value.type]]),Ve,E(t("select",{"onUpdate:modelValue":o[6]||(o[6]=s=>_.value=s),class:"p-2 bg-white border rounded-sm",onKeyup:o[7]||(o[7]=N((...s)=>e(u)&&e(u)(...s),["enter"]))},[(n(!0),r(k,null,M(((v=e(m))==null?void 0:v.matters)||[],s=>(n(),r("option",{value:s.abbr},l(s.name),9,Ie))),256))],544),[[Y,_.value]]),Ke,E(t("input",{type:"text","onUpdate:modelValue":o[8]||(o[8]=s=>d.value.title=s),class:"p-2 border rounded-sm",onKeyup:o[9]||(o[9]=N((...s)=>e(u)&&e(u)(...s),["enter"]))},null,544),[[W,d.value.title]]),t("div",Oe,[t("button",{onClick:o[10]||(o[10]=(...s)=>e(u)&&e(u)(...s)),class:"flex-grow p-2 mt-2 text-white rounded-sm bg-etml hover:opacity-90 active:opacity-80",disabled:e(K)}," Valider ",8,Re),d.value.id?(n(),r("button",{key:0,onMouseenter:re,onMouseleave:le,onClick:o[11]||(o[11]=(...s)=>e($)&&e($)(...s)),class:"p-2 mt-2 font-semibold text-white bg-red-600 rounded-sm hover:opacity-90 active:opacity-80 aspect-square disabled:cursor-not-allowed",disabled:b.value||e(U)},l(b.value||"⨉"),41,Je)):g("",!0)])])}}},Ye={class:"px-1 text-white bg-orange-700"},qe={class:"text-2xl font-light"},Be={class:"ml-2 font-light uppercase text-md"},Le={class:"float-right text-2xl font-light"},Pe={class:"leading-snug border-b border-orange-700"},je=t("td",{class:"px-0 py-1 align-top"},[t("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"})],-1),Fe={key:0,class:"px-2 py-1 font-semibold align-top"},Ge=["colspan"],ze={key:1,class:"py-1 align-top"},We=["onClick"],X={__name:"DayPopup",setup(L){const i=B(),x=ae(),d=q();return(_,p)=>(n(),r("div",null,[t("h2",Ye,[t("span",qe,l(e(i).additionalData.day.date.getDate()),1),t("span",Be,l(e(ee)[e(i).additionalData.day.date.getDay()]),1),t("span",Le,l(e(te)[e(i).additionalData.day.date.getMonth()]),1)]),t("table",null,[(n(!0),r(k,null,M([...e(i).additionalData.day.tasks].sort(e(se)),m=>(n(),r("tr",Pe,[je,m.matter.shortName?(n(),r("td",Fe,l(m.matter.abbr=="ecdr"&&e(d).params.promotion=="mtu2e"?"Droit":m.matter.shortName),1)):g("",!0),t("td",{class:"px-2 py-1 align-top",colspan:m.matter.shortName?1:2},l(e(oe)[m.type].emoji)+" "+l(m.title),9,Ge),e(x).isAdmin?(n(),r("td",ze,[t("button",{onClick:u=>{e(i).component=ne,e(i).additionalData=m},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Éditer ",8,We)])):g("",!0)]))),256))])]))}},He={class:"flex flex-col flex-wrap gap-y-4 gap-x-16"},Xe={class:"w-full xl:w-1/2 xl:pr-16"},Ze={class:"text-2xl font-light border-b border-black"},et={class:"float-right"},tt=t("div",{class:"w-full border-b border-orange-700"},[t("h2",{class:"inline font-black text-orange-700 uppercase text-2xs"}," Communications ")],-1),ot={class:"w-full border-b border-orange-700"},st=t("div",{class:"text-center text-red-500"},"Une erreur est survenue",-1),at=t("div",{class:"w-full border-b border-orange-700"}," ",-1),nt={class:"w-full xl:w-1/2 xl:pr-16"},rt=["onClick"],lt={class:"text-2xl font-light"},it={class:"ml-2 font-light uppercase text-md"},dt={key:0,class:"float-right text-2xl font-light"},ut=["title"],ct=t("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"},null,-1),pt={key:0,class:"inline-block w-20 font-semibold"},mt={class:"leading-relaxed border-b border-orange-700"},_t=["onClick"],gt=["onClick"],bt={class:"leading-relaxed border-b border-orange-700"},T=5,C=3,xt={__name:"AgendaPage",setup(L){const i=q(),x=pe(),d=ae(),_=B(),p=H(()=>{const y=parseInt(i.params.week);return y>26&&y<34&&x.push({name:i.name,params:{...i.params,week:34}}),y}),m=H(()=>be(i.params.promotion,p.value)),{result:u,error:K}=Z(I,()=>({promotion:i.params.promotion,year:m.value,week:p.value}));return(y,P)=>{var $,U,S;return n(),r("div",He,[t("div",Xe,[t("h1",Ze,[f(" Semaine "+l(p.value)+" ",1),t("span",et,l(m.value),1)]),tt,t("div",ot,[e(K)?(n(),me(ge,{key:0,appear:""},{default:_e(()=>[st]),_:1})):(n(),r(k,{key:1},[f(" ")],64))]),at]),(n(!0),r(k,null,M(((S=(U=($=e(u))==null?void 0:$.week)==null?void 0:U.days)==null?void 0:S.map(a=>({...a,strDate:a.date,date:new Date(a.date)})))||[],(a,b)=>(n(),r("div",nt,[t("h2",{onClick:c=>a.tasks.length?[e(_).component=X,e(_).additionalData={day:a}]:[],class:he(["px-1 text-white bg-orange-700",{"cursor-pointer":a.tasks.length}])},[t("span",lt,l(a.date.getDate()),1),t("span",it,l(e(ee)[a.date.getDay()]),1),b==0||a.date.getDate()==1?(n(),r("span",dt,l(e(te)[a.date.getMonth()]),1)):g("",!0)],10,rt),t("ul",null,[(n(!0),r(k,null,M([...a.tasks].sort(e(se)).slice(0,(a.date.getDay()?T:C)-1),c=>(n(),r("li",{class:"relative leading-relaxed truncate border-b border-orange-700",title:c.title},[ct,f(" "+l()+" ",1),c.matter.shortName?(n(),r("span",pt,l(c.matter.abbr=="ecdr"&&e(i).params.promotion=="mtu2e"?"Droit":c.matter.shortName),1)):g("",!0),f(" "+l(e(oe)[c.type].emoji)+" "+l(c.title),1)],8,ut))),256)),t("li",mt,[a.tasks.length>=(a.date.getDay()?T:C)?(n(),r(k,{key:0},[f(" + "+l(a.tasks.length+1-(a.date.getDay()?T:C))+" "+l(a.tasks.length+1-(a.date.getDay()?T:C)>=2?"autres éléments":"autre élément")+" ",1),t("button",{onClick:c=>a.tasks.length?[e(_).component=X,e(_).additionalData={day:a}]:[],class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Voir ",8,_t)],64)):g("",!0),e(d).isAdmin?(n(),r("button",{key:1,onClick:c=>{e(_).component=ne,e(_).additionalData={date:a.strDate,promotion:e(i).params.promotion,matter:"",type:"homework",title:""}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Ajouter ",8,gt)):g("",!0),f("   ")]),(n(!0),r(k,null,M(Math.max((a.date.getDay()?T:C)-a.tasks.length-1,0),c=>(n(),r("li",bt,"   "))),256))])]))),256))])}}};export{xt as default};
