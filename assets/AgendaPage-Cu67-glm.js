import{u as G,f as z,r as K,m as ae,g as ee,p as B,a as r,o as n,e as o,b as v,w as E,d as e,t as l,v as te,h as N,q as P,F as k,l as M,s as se,x as ne,y as re,z as le,c as j,A as ge,B as ve,i as D,C as F,D as L,T as O,E as ye,n as xe}from"./index-DLuxh3t_.js";import{G as R,M as ke,D as we,a as fe,u as ie}from"./auth-usQJemLc.js";const De={class:"flex flex-col gap-2"},_e={key:0,class:"text-red-500"},he={key:1,class:"text-red-500"},Se=["value"],$e={class:"flex gap-1"},Ee=["disabled"],Ne=["disabled"],de={__name:"TaskForm",setup(W){var H;const i=G(),w=z(),d=K({...w.additionalData}),g=K(((H=d.value.matter)==null?void 0:H.abbr)??""),b=K({...d.value}),{result:m}=ae(fe),{mutate:u,loading:J,error:A,onDone:_}=ee(ke,()=>({variables:{...d.value,matter:g.value},update:(y,{data:{task:t}})=>{if(b.value.id){const f=new Date(b.value.date),X=(f.getDay()+6)%7,{year:pe,week:me}=B(f),Z={query:R,variables:{promotion:b.value.promotion,year:pe,week:me}},ce=y.readQuery(Z),q=JSON.parse(JSON.stringify(ce));q.week.days[X].tasks=q.week.days[X].tasks.filter(be=>be.id!=b.value.id),y.writeQuery({...Z,data:q})}const x=new Date(t.date),s=(x.getDay()+6)%7,{year:Y,week:I}=B(x),Q={query:R,variables:{promotion:t.promotion,year:Y,week:I}},S=y.readQuery(Q);if(S){const f=JSON.parse(JSON.stringify(S));f.week.days[s].tasks.push(t),y.writeQuery({...Q,data:f})}}}));_(()=>{w.component=null});const{mutate:p,loading:U,error:$,onDone:V}=ee(we,()=>({variables:{id:b.value.id},update:y=>{const t=new Date(b.value.date),x=(t.getDay()+6)%7,{year:s,week:Y}=B(t),I={query:R,variables:{promotion:i.params.promotion,year:s,week:Y}},Q=y.readQuery(I),S=JSON.parse(JSON.stringify(Q));S.week.days[x].tasks=S.week.days[x].tasks.filter(f=>f.id!=b.value.id),y.writeQuery({...I,data:S})}}));V(()=>{w.component=null});const a=K(3);let h;const c=()=>{a.value--,h=setInterval(()=>{a.value--,a.value==0&&clearInterval(h)},1e3)},ue=()=>{clearInterval(h),a.value=3};return(y,t)=>{var x;return n(),r("div",De,[t[14]||(t[14]=o("h2",{class:"text-xl font-semibold text-center"},"Devoir",-1)),e(A)?(n(),r("span",_e,l(e(A).message),1)):v("",!0),e($)?(n(),r("span",he,l(e($).message),1)):v("",!0),t[15]||(t[15]=o("label",null,"Date :",-1)),E(o("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=s=>d.value.date=s),onKeyup:t[1]||(t[1]=N((...s)=>e(u)&&e(u)(...s),["enter"])),class:"p-2 border rounded-sm"},null,544),[[te,d.value.date]]),t[16]||(t[16]=o("label",null,"Classe :",-1)),E(o("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>d.value.promotion=s),onKeyup:t[3]||(t[3]=N((...s)=>e(u)&&e(u)(...s),["enter"])),class:"p-2 bg-white border rounded-sm"},t[12]||(t[12]=[o("option",{value:"mtu1e"},"MTU1E",-1),o("option",{value:"mtu2e"},"MTU2E",-1)]),544),[[P,d.value.promotion]]),t[17]||(t[17]=o("label",null,"Type :",-1)),E(o("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>d.value.type=s),onKeyup:t[5]||(t[5]=N((...s)=>e(u)&&e(u)(...s),["enter"])),class:"p-2 bg-white border rounded-sm"},t[13]||(t[13]=[o("option",{value:"homework"},"Devoir",-1),o("option",{value:"test"},"Test",-1),o("option",{value:"info"},"Information",-1)]),544),[[P,d.value.type]]),t[18]||(t[18]=o("label",null,"Matière :",-1)),E(o("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>g.value=s),onKeyup:t[7]||(t[7]=N((...s)=>e(u)&&e(u)(...s),["enter"])),class:"p-2 bg-white border rounded-sm"},[(n(!0),r(k,null,M(((x=e(m))==null?void 0:x.matters)||[],s=>(n(),r("option",{key:s.abbr,value:s.abbr},l(s.name),9,Se))),128))],544),[[P,g.value]]),t[19]||(t[19]=o("label",null,"Titre :",-1)),E(o("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=s=>d.value.title=s),onKeyup:t[9]||(t[9]=N((...s)=>e(u)&&e(u)(...s),["enter"])),class:"p-2 border rounded-sm"},null,544),[[te,d.value.title]]),o("div",$e,[o("button",{onClick:t[10]||(t[10]=(...s)=>e(u)&&e(u)(...s)),class:"flex-grow p-2 mt-2 text-white rounded-sm bg-etml hover:opacity-90 active:opacity-80",disabled:e(J)}," Valider ",8,Ee),d.value.id?(n(),r("button",{key:0,onMouseenter:c,onMouseleave:ue,onClick:t[11]||(t[11]=(...s)=>e(p)&&e(p)(...s)),class:"p-2 mt-2 font-semibold text-white bg-red-600 rounded-sm hover:opacity-90 active:opacity-80 aspect-square disabled:cursor-not-allowed",disabled:a.value||e(U)},l(a.value||"⨉"),41,Ne)):v("",!0)])])}}},Te={class:"px-1 text-white bg-orange-700"},Ce={class:"text-2xl font-light"},Me={class:"ml-2 font-light uppercase text-md"},Ae={class:"float-right text-2xl font-light"},Ue={key:0,class:"px-2 py-1 font-semibold align-top"},Ve=["colspan"],Ie={key:1,class:"py-1 align-top"},Qe=["onClick"],oe={__name:"DayPopup",setup(W){const i=z(),w=ie(),d=G();return(g,b)=>(n(),r("div",null,[o("h2",Te,[o("span",Ce,l(e(i).additionalData.day.date.getDate()),1),o("span",Me,l(e(se)[e(i).additionalData.day.date.getDay()]),1),o("span",Ae,l(e(ne)[e(i).additionalData.day.date.getMonth()]),1)]),o("table",null,[(n(!0),r(k,null,M([...e(i).additionalData.day.tasks].sort(e(le)),m=>(n(),r("tr",{key:m.id,class:"leading-snug border-b border-orange-700"},[b[0]||(b[0]=o("td",{class:"px-0 py-1 align-top"},[o("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"})],-1)),m.matter.shortName?(n(),r("td",Ue,l(m.matter.abbr=="ecdr"&&e(d).params.promotion=="mtu2e"?"Droit":m.matter.shortName),1)):v("",!0),o("td",{class:"px-2 py-1 align-top",colspan:m.matter.shortName?1:2},l(e(re)[m.type].emoji)+" "+l(m.title),9,Ve),e(w).isAdmin?(n(),r("td",Ie,[o("button",{onClick:u=>{e(i).component=de,e(i).additionalData=m},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Éditer ",8,Qe)])):v("",!0)]))),128))])]))}},Ke={class:"flex flex-col flex-wrap gap-y-4 gap-x-16"},Le={class:"w-full xl:w-1/2 xl:pr-16"},Oe={class:"text-2xl font-light border-b border-black"},Re={class:"float-right"},Je={class:"w-full border-b border-orange-700"},Ye={class:"w-full border-b border-orange-700"},qe={class:"transition-opacity"},Be=["onClick"],Pe={class:"text-2xl font-light"},je={class:"ml-2 font-light uppercase text-md"},Fe={key:0,class:"float-right text-2xl font-light"},Ge=["title"],ze={key:0,class:"inline-block w-20 font-semibold"},We={class:"leading-relaxed border-b border-orange-700"},He=["onClick"],Xe=["onClick"],T=5,C=3,tt={__name:"AgendaPage",setup(W){const i=G(),w=ge(),d=ie(),g=z(),b=j(()=>navigator.onLine),m=j(()=>{const _=parseInt(i.params.week);return _>26&&_<34&&w.push({name:i.name,params:{...i.params,week:34}}),_}),u=j(()=>ve(i.params.promotion,m.value)),{result:J,error:A}=ae(R,()=>({promotion:i.params.promotion,year:u.value,week:m.value}),{fetchPolicy:"cache-and-network"});return(_,p)=>{var U,$,V;return n(),r("div",Ke,[o("div",Le,[o("h1",Oe,[D(" Semaine "+l(m.value)+" ",1),o("span",Re,l(u.value),1)]),p[3]||(p[3]=o("div",{class:"w-full border-b border-orange-700"},[o("h2",{class:"inline font-black text-orange-700 uppercase text-2xs"}," Communications ")],-1)),o("div",Je,[b.value?e(A)?(n(),F(O,{key:1,appear:""},{default:L(()=>p[1]||(p[1]=[o("div",{class:"text-center text-red-500 transition-opacity"}," Une erreur est survenue ",-1)])),_:1})):(n(),r(k,{key:2},[D(" ")],64)):(n(),F(O,{key:0,appear:""},{default:L(()=>p[0]||(p[0]=[o("div",{class:"text-center text-red-500 transition-opacity"}," Aucune connexion Internet ! ",-1)])),_:1}))]),o("div",Ye,[b.value?(n(),r(k,{key:1},[D(" ")],64)):(n(),F(O,{key:0,appear:""},{default:L(()=>p[2]||(p[2]=[o("div",{class:"text-center text-red-500 transition-opacity"}," Les données peuvent ne pas être à jour. ",-1)])),_:1}))])]),(n(!0),r(k,null,M(((V=($=(U=e(J))==null?void 0:U.week)==null?void 0:$.days)==null?void 0:V.map(a=>({...a,strDate:a.date,date:new Date(a.date)})))||[],(a,h)=>(n(),r("div",{key:h,class:"w-full xl:w-1/2 xl:pr-16"},[ye(O,{appear:""},{default:L(()=>[o("div",qe,[o("h2",{onClick:c=>a.tasks.length?[e(g).component=oe,e(g).additionalData={day:a}]:[],class:xe(["px-1 text-white bg-orange-700",{"cursor-pointer":a.tasks.length}])},[o("span",Pe,l(a.date.getDate()),1),o("span",je,l(e(se)[a.date.getDay()]),1),h==0||a.date.getDate()==1?(n(),r("span",Fe,l(e(ne)[a.date.getMonth()]),1)):v("",!0)],10,Be),o("ul",null,[(n(!0),r(k,null,M([...a.tasks].sort(e(le)).slice(0,(a.date.getDay()?T:C)-1),c=>(n(),r("li",{key:c.id,class:"relative leading-relaxed truncate border-b border-orange-700",title:c.title},[p[4]||(p[4]=o("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"},null,-1)),D(" "+l()+" ",1),c.matter.shortName?(n(),r("span",ze,l(c.matter.abbr=="ecdr"&&e(i).params.promotion=="mtu2e"?"Droit":c.matter.shortName),1)):v("",!0),D(" "+l(e(re)[c.type].emoji)+" "+l(c.title),1)],8,Ge))),128)),o("li",We,[a.tasks.length>=(a.date.getDay()?T:C)?(n(),r(k,{key:0},[D(" + "+l(a.tasks.length+1-(a.date.getDay()?T:C))+" "+l(a.tasks.length+1-(a.date.getDay()?T:C)>=2?"autres éléments":"autre élément")+" ",1),o("button",{onClick:c=>a.tasks.length?[e(g).component=oe,e(g).additionalData={day:a}]:[],class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Voir ",8,He)],64)):v("",!0),e(d).isAdmin?(n(),r("button",{key:1,onClick:c=>{e(g).component=de,e(g).additionalData={date:a.strDate,promotion:e(i).params.promotion,matter:"",type:"homework",title:""}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Ajouter ",8,Xe)):v("",!0),p[5]||(p[5]=D("   "))]),(n(!0),r(k,null,M(Math.max((a.date.getDay()?T:C)-a.tasks.length-1,0),c=>(n(),r("li",{key:c,class:"leading-relaxed border-b border-orange-700"},"   "))),128))])])]),_:2},1024)]))),128))])}}};export{tt as default};
