import{G as st,a as U,M as nt,D as rt,u as j}from"./auth.14ce3752.js";import{u as Y,r as Q,y as F,e as L,A as V,o as l,c as i,b as t,t as p,d as b,w as y,v as O,a as e,f as x,g as R,F as f,z as k,B as z,C as W,D as H,E as X,G as Z,h as M,n as P}from"./index.1a708ee2.js";const lt={class:"flex flex-col gap-2"},it=e("h2",{class:"text-xl font-bold text-center"},"Devoir",-1),dt={key:0,class:"text-red-500"},ut={key:1,class:"text-red-500"},pt=e("label",null,"Date :",-1),ct=e("label",null,"Classe :",-1),mt=e("option",{value:"mtu1e"},"MTU1E",-1),_t=[mt],bt=e("label",null,"Type :",-1),gt=e("option",{value:"homework"},"Devoir",-1),ht=e("option",{value:"test"},"Test",-1),vt=e("option",{value:"info"},"Information",-1),yt=e("option",{value:"summary"},"R\xE9sum\xE9 de cours",-1),xt=[gt,ht,vt,yt],Dt=e("label",null,"Mati\xE8re :",-1),wt=["value"],ft=e("label",null,"Title :",-1),kt=e("label",null,"Description :",-1),$t={class:"flex gap-1"},St=["disabled"],J={__name:"TaskForm",setup(q){const n=Y(),d=Q({id:n.additionalData.id||null,date:n.additionalData.date||"",promotion:n.additionalData.promotion||"mtu1e",type:n.additionalData.type||"homework",matter:n.additionalData.matter||"",title:n.additionalData.title||"",content:n.additionalData.content||""}),m=Q({...d.value}),{result:$}=F(st),{mutate:u,error:c,onDone:D}=L(nt,()=>({variables:d.value,update:(r,{data:{task:o}})=>{if(m.value.id){const h=new Date(m.value.date),B=(h.getDay()+6)%7,{year:tt,week:et}=V(h),G={query:U,variables:{promotion:m.value.promotion,year:tt,week:et}},ot=r.readQuery(G),K=JSON.parse(JSON.stringify(ot));K.week.days[B].tasks=K.week.days[B].tasks.filter(at=>at.id!=m.value.id),r.writeQuery({...G,data:K})}const _=new Date(o.date),a=(_.getDay()+6)%7,{year:I,week:T}=V(_),C={query:U,variables:{promotion:o.promotion,year:I,week:T}},v=r.readQuery(C);if(v){const h=JSON.parse(JSON.stringify(v));h.week.days[a].tasks.push(o),r.writeQuery({...C,data:h})}}}));D(()=>{n.component=!1});const{mutate:S,error:w,onDone:E}=L(rt,()=>({variables:{id:m.value.id},update:r=>{const o=new Date(m.value.date),_=(o.getDay()+6)%7,{year:a,week:I}=V(o),T={query:U,variables:{promotion:m.value.promotion,year:a,week:I}},C=r.readQuery(T),v=JSON.parse(JSON.stringify(C));v.week.days[_].tasks=v.week.days[_].tasks.filter(h=>h.id!=m.value.id),r.writeQuery({...T,data:v})}}));E(()=>{n.component=!1});const g=Q(3);let s;const A=()=>{g.value--,s=setInterval(()=>{g.value--,g.value==0&&clearInterval(s)},1e3)},N=()=>{clearInterval(s),g.value=3};return(r,o)=>{var _;return l(),i("div",lt,[it,t(c)?(l(),i("span",dt,p(t(c).message),1)):b("",!0),t(w)?(l(),i("span",ut,p(t(w).message),1)):b("",!0),pt,y(e("input",{type:"date","onUpdate:modelValue":o[0]||(o[0]=a=>d.value.date=a),class:"p-2 border rounded-sm",onKeyup:o[1]||(o[1]=x((...a)=>t(u)&&t(u)(...a),["enter"]))},null,544),[[O,d.value.date]]),ct,y(e("select",{"onUpdate:modelValue":o[2]||(o[2]=a=>d.value.promotion=a),class:"p-2 bg-white border rounded-sm",onKeyup:o[3]||(o[3]=x((...a)=>t(u)&&t(u)(...a),["enter"]))},_t,544),[[R,d.value.promotion]]),bt,y(e("select",{"onUpdate:modelValue":o[4]||(o[4]=a=>d.value.type=a),class:"p-2 bg-white border rounded-sm",onKeyup:o[5]||(o[5]=x((...a)=>t(u)&&t(u)(...a),["enter"]))},xt,544),[[R,d.value.type]]),Dt,y(e("select",{"onUpdate:modelValue":o[6]||(o[6]=a=>d.value.matter=a),class:"p-2 bg-white border rounded-sm",onKeyup:o[7]||(o[7]=x((...a)=>t(u)&&t(u)(...a),["enter"]))},[(l(!0),i(f,null,k(((_=t($))==null?void 0:_.matters)||[],a=>(l(),i("option",{value:a.abbr},p(a.name),9,wt))),256))],544),[[R,d.value.matter]]),ft,y(e("input",{type:"text","onUpdate:modelValue":o[8]||(o[8]=a=>d.value.title=a),class:"p-2 border rounded-sm",onKeyup:o[9]||(o[9]=x((...a)=>t(u)&&t(u)(...a),["enter"]))},null,544),[[O,d.value.title]]),kt,y(e("input",{type:"text","onUpdate:modelValue":o[10]||(o[10]=a=>d.value.content=a),class:"p-2 border rounded-sm",onKeyup:o[11]||(o[11]=x((...a)=>t(u)&&t(u)(...a),["enter"]))},null,544),[[O,d.value.content]]),e("div",$t,[e("button",{onClick:o[12]||(o[12]=(...a)=>t(u)&&t(u)(...a)),class:"flex-grow p-2 mt-2 text-white rounded-sm bg-etml hover:opacity-90 active:opacity-80"}," Valider "),d.value.id?(l(),i("button",{key:0,onMouseenter:A,onMouseleave:N,onClick:o[13]||(o[13]=(...a)=>t(S)&&t(S)(...a)),class:"p-2 mt-2 font-bold text-white bg-red-600 rounded-sm hover:opacity-90 active:opacity-80 aspect-square disabled:cursor-not-allowed",disabled:g.value},p(g.value||"\u2A09"),41,St)):b("",!0)])])}}},Et={class:"px-1 text-white bg-orange-700"},Nt={class:"text-2xl font-light"},Tt={class:"ml-2 font-light uppercase text-md"},Ct={class:"float-right text-2xl font-light"},Mt={class:"leading-relaxed border-b border-orange-700"},Ut=e("td",{class:"inline-block w-4 h-4 border border-orange-700 cursor-pointer"},null,-1),At={key:0,class:"px-2 font-bold align-top"},It=["colspan"],Kt={key:1,class:"align-top"},Qt=["onClick"],Vt={__name:"DayPopup",setup(q){const n=Y(),d=j(),m=z();return($,u)=>(l(),i("div",null,[e("h2",Et,[e("span",Nt,p(t(n).additionalData.day.date.getDate()),1),e("span",Tt,p(t(W)[t(n).additionalData.day.date.getDay()]),1),e("span",Ct,p(t(H)[t(n).additionalData.day.date.getMonth()]),1)]),e("table",null,[(l(!0),i(f,null,k([...t(n).additionalData.day.tasks].sort(t(Z)),c=>{var D;return l(),i("tr",Mt,[Ut,c.matter.shortName?(l(),i("td",At,p(c.matter.shortName),1)):b("",!0),e("td",{class:"px-2 align-top",colspan:c.matter.shortName?1:2},p(t(X)[c.type].emoji)+" "+p(c.title),9,It),(D=t(d).user)!=null&&D.admin?(l(),i("td",Kt,[e("button",{onClick:S=>{t(n).component=J,t(n).additionalData={id:c.id,date:c.date,promotion:t(m).params.promotion,type:c.type,matter:c.matter.abbr,title:c.title,content:c.content}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Edit ",8,Qt)])):b("",!0)])}),256))])]))}},Ot={class:"flex flex-col flex-wrap gap-y-4 gap-x-16"},Rt={class:"w-full xl:w-1/2 xl:pr-16"},Jt={class:"text-2xl font-light border-b border-black"},Yt={class:"float-right"},qt=e("div",{class:"w-full border-b border-orange-700"},[e("h2",{class:"inline font-bold text-orange-700 uppercase text-2xs"}," Communications ")],-1),Bt=e("div",{class:"w-full border-b border-orange-700"},"\xA0",-1),Gt=e("div",{class:"w-full border-b border-orange-700"},"\xA0",-1),Lt={class:"w-full xl:w-1/2 xl:pr-16"},Pt=["onClick"],jt={class:"text-2xl font-light"},Ft={class:"ml-2 font-light uppercase text-md"},zt={key:0,class:"float-right text-2xl font-light"},Wt=e("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"},null,-1),Ht={key:0,class:"inline-block w-20"},Xt=["title"],Zt=["onClick"],te={class:"leading-relaxed border-b border-orange-700"},ee={key:0},oe=["onClick"],ae={class:"leading-relaxed border-b border-orange-700"},re={__name:"AgendaPage",setup(q){const n=z(),d=j(),m=Y(),{result:$}=F(U,()=>({promotion:n.params.promotion,year:parseInt(n.params.year),week:parseInt(n.params.week)})),u=5,c=3;return(D,S)=>{var w,E,g;return l(),i("div",Ot,[e("div",Rt,[e("h1",Jt,[M(" Semaine "+p(t(n).params.week)+" ",1),e("span",Yt,p(t(n).params.year),1)]),qt,Bt,Gt]),(l(!0),i(f,null,k(((g=(E=(w=t($))==null?void 0:w.week)==null?void 0:E.days)==null?void 0:g.map(s=>({...s,strDate:s.date,date:new Date(s.date)})))||[],(s,A)=>{var N;return l(),i("div",Lt,[e("h2",{class:P(["px-1 text-white bg-orange-700",{"cursor-pointer":s.tasks.length}]),onClick:r=>s.tasks.length?[t(m).component=Vt,t(m).additionalData={day:s}]:[]},[e("span",jt,p(s.date.getDate()),1),e("span",Ft,p(t(W)[s.date.getDay()]),1),A==0||s.date.getDate()==1?(l(),i("span",zt,p(t(H)[s.date.getMonth()]),1)):b("",!0)],10,Pt),e("ul",null,[(l(!0),i(f,null,k([...s.tasks].sort(t(Z)).slice(0,(s.date.getDay()?u:c)-1),r=>{var o,_;return l(),i("li",{class:P(["relative leading-relaxed truncate border-b border-orange-700",{"pr-8":(o=t(d).user)==null?void 0:o.admin}])},[Wt,M(" "+p()+" ",1),r.matter.shortName?(l(),i("strong",Ht,p(r.matter.shortName),1)):b("",!0),M(" "+p(t(X)[r.type].emoji)+" ",1),e("span",{title:r.title},p(r.title),9,Xt),(_=t(d).user)!=null&&_.admin?(l(),i("button",{key:1,onClick:a=>{t(m).component=J,t(m).additionalData={id:r.id,date:r.date,promotion:t(n).params.promotion,type:r.type,matter:r.matter.abbr,title:r.title,content:r.content}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml absolute right-0 my-1"}," Edit ",8,Zt)):b("",!0)],2)}),256)),e("li",te,[s.tasks.length>=(s.date.getDay()?u:c)?(l(),i("span",ee," + "+p(s.tasks.length+1-(s.date.getDay()?u:c))+" "+p(s.tasks.length+1-(s.date.getDay()?u:c)>=2?"autres \xE9l\xE9ments":"autre \xE9l\xE9ment"),1)):b("",!0),(N=t(d).user)!=null&&N.admin?(l(),i("button",{key:1,onClick:r=>{t(m).component=J,t(m).additionalData={date:s.strDate}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Ajouter ",8,oe)):b("",!0),M(" \xA0 ")]),(l(!0),i(f,null,k(Math.max((s.date.getDay()?u:c)-s.tasks.length-1,0),r=>(l(),i("li",ae," \xA0 "))),256))])])}),256))])}}};export{re as default};
