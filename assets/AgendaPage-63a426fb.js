import{u as q,f as B,r as Q,m as te,g as z,p as J,o as n,a as r,b as e,t as l,e as g,w as E,v as W,d as t,h as N,q as Y,F as k,l as M,s as oe,x as se,y as ae,z as ne,A as _e,c as H,i as f,B as be,C as X,T as Z,D as ge,E as he,n as ve}from"./index-17f97c40.js";import{G as ye,a as I,M as xe,D as we,u as re}from"./auth-cdf2b415.js";const ke={class:"flex flex-col gap-2"},De=t("h2",{class:"text-xl font-semibold text-center"},"Devoir",-1),fe={key:0,class:"text-red-500"},$e={key:1,class:"text-red-500"},Se=t("label",null,"Date :",-1),Ee=t("label",null,"Classe :",-1),Ne=t("option",{value:"mtu1e"},"MTU1E",-1),Te=t("option",{value:"mtu2e"},"MTU2E",-1),Ce=[Ne,Te],Me=t("label",null,"Type :",-1),Ue=t("option",{value:"homework"},"Devoir",-1),Ae=t("option",{value:"test"},"Test",-1),Ve=t("option",{value:"info"},"Information",-1),Qe=[Ue,Ae,Ve],Ie=t("label",null,"Matière :",-1),Ke=["value"],Oe=t("label",null,"Titre :",-1),Re={class:"flex gap-1"},Je=["disabled"],Ye=["disabled"],le={__name:"TaskForm",setup(L){var j;const i=q(),y=B(),d=Q({...y.additionalData}),_=Q(((j=d.value.matter)==null?void 0:j.abbr)??""),m=Q({...d.value}),{result:p}=te(ye),{mutate:c,loading:K,error:x,onDone:P}=z(xe,()=>({variables:{...d.value,matter:_.value},update:(h,{data:{task:o}})=>{if(m.value.id){const w=new Date(m.value.date),F=(w.getDay()+6)%7,{year:ue,week:ce}=J(w),G={query:I,variables:{promotion:m.value.promotion,year:ue,week:ce}},pe=h.readQuery(G),R=JSON.parse(JSON.stringify(pe));R.week.days[F].tasks=R.week.days[F].tasks.filter(me=>me.id!=m.value.id),h.writeQuery({...G,data:R})}const v=new Date(o.date),s=(v.getDay()+6)%7,{year:O,week:A}=J(v),V={query:I,variables:{promotion:o.promotion,year:O,week:A}},D=h.readQuery(V);if(D){const w=JSON.parse(JSON.stringify(D));w.week.days[s].tasks.push(o),h.writeQuery({...V,data:w})}}}));P(()=>{y.component=null});const{mutate:$,loading:U,error:S,onDone:a}=z(we,()=>({variables:{id:m.value.id},update:h=>{const o=new Date(m.value.date),v=(o.getDay()+6)%7,{year:s,week:O}=J(o),A={query:I,variables:{promotion:i.params.promotion,year:s,week:O}},V=h.readQuery(A),D=JSON.parse(JSON.stringify(V));D.week.days[v].tasks=D.week.days[v].tasks.filter(w=>w.id!=m.value.id),h.writeQuery({...A,data:D})}}));a(()=>{y.component=null});const b=Q(3);let u;const ie=()=>{b.value--,u=setInterval(()=>{b.value--,b.value==0&&clearInterval(u)},1e3)},de=()=>{clearInterval(u),b.value=3};return(h,o)=>{var v;return n(),r("div",ke,[De,e(x)?(n(),r("span",fe,l(e(x).message),1)):g("",!0),e(S)?(n(),r("span",$e,l(e(S).message),1)):g("",!0),Se,E(t("input",{type:"date","onUpdate:modelValue":o[0]||(o[0]=s=>d.value.date=s),onKeyup:o[1]||(o[1]=N((...s)=>e(c)&&e(c)(...s),["enter"])),class:"p-2 border rounded-sm"},null,544),[[W,d.value.date]]),Ee,E(t("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>d.value.promotion=s),onKeyup:o[3]||(o[3]=N((...s)=>e(c)&&e(c)(...s),["enter"])),class:"p-2 bg-white border rounded-sm"},Ce,544),[[Y,d.value.promotion]]),Me,E(t("select",{"onUpdate:modelValue":o[4]||(o[4]=s=>d.value.type=s),onKeyup:o[5]||(o[5]=N((...s)=>e(c)&&e(c)(...s),["enter"])),class:"p-2 bg-white border rounded-sm"},Qe,544),[[Y,d.value.type]]),Ie,E(t("select",{"onUpdate:modelValue":o[6]||(o[6]=s=>_.value=s),onKeyup:o[7]||(o[7]=N((...s)=>e(c)&&e(c)(...s),["enter"])),class:"p-2 bg-white border rounded-sm"},[(n(!0),r(k,null,M(((v=e(p))==null?void 0:v.matters)||[],s=>(n(),r("option",{key:s.abbr,value:s.abbr},l(s.name),9,Ke))),128))],544),[[Y,_.value]]),Oe,E(t("input",{type:"text","onUpdate:modelValue":o[8]||(o[8]=s=>d.value.title=s),onKeyup:o[9]||(o[9]=N((...s)=>e(c)&&e(c)(...s),["enter"])),class:"p-2 border rounded-sm"},null,544),[[W,d.value.title]]),t("div",Re,[t("button",{onClick:o[10]||(o[10]=(...s)=>e(c)&&e(c)(...s)),class:"flex-grow p-2 mt-2 text-white rounded-sm bg-etml hover:opacity-90 active:opacity-80",disabled:e(K)}," Valider ",8,Je),d.value.id?(n(),r("button",{key:0,onMouseenter:ie,onMouseleave:de,onClick:o[11]||(o[11]=(...s)=>e($)&&e($)(...s)),class:"p-2 mt-2 font-semibold text-white bg-red-600 rounded-sm hover:opacity-90 active:opacity-80 aspect-square disabled:cursor-not-allowed",disabled:b.value||e(U)},l(b.value||"⨉"),41,Ye)):g("",!0)])])}}},qe={class:"px-1 text-white bg-orange-700"},Be={class:"text-2xl font-light"},Le={class:"ml-2 font-light uppercase text-md"},Pe={class:"float-right text-2xl font-light"},je=t("td",{class:"px-0 py-1 align-top"},[t("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"})],-1),Fe={key:0,class:"px-2 py-1 font-semibold align-top"},Ge=["colspan"],ze={key:1,class:"py-1 align-top"},We=["onClick"],ee={__name:"DayPopup",setup(L){const i=B(),y=re(),d=q();return(_,m)=>(n(),r("div",null,[t("h2",qe,[t("span",Be,l(e(i).additionalData.day.date.getDate()),1),t("span",Le,l(e(oe)[e(i).additionalData.day.date.getDay()]),1),t("span",Pe,l(e(se)[e(i).additionalData.day.date.getMonth()]),1)]),t("table",null,[(n(!0),r(k,null,M([...e(i).additionalData.day.tasks].sort(e(ne)),p=>(n(),r("tr",{key:p.id,class:"leading-snug border-b border-orange-700"},[je,p.matter.shortName?(n(),r("td",Fe,l(p.matter.abbr=="ecdr"&&e(d).params.promotion=="mtu2e"?"Droit":p.matter.shortName),1)):g("",!0),t("td",{class:"px-2 py-1 align-top",colspan:p.matter.shortName?1:2},l(e(ae)[p.type].emoji)+" "+l(p.title),9,Ge),e(y).isAdmin?(n(),r("td",ze,[t("button",{onClick:c=>{e(i).component=le,e(i).additionalData=p},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Éditer ",8,We)])):g("",!0)]))),128))])]))}},He={class:"flex flex-col flex-wrap gap-y-4 gap-x-16"},Xe={class:"w-full xl:w-1/2 xl:pr-16"},Ze={class:"text-2xl font-light border-b border-black"},et={class:"float-right"},tt=t("div",{class:"w-full border-b border-orange-700"},[t("h2",{class:"inline font-black text-orange-700 uppercase text-2xs"}," Communications ")],-1),ot={class:"w-full border-b border-orange-700"},st=t("div",{class:"text-center text-red-500 transition-opacity"}," Une erreur est survenue ",-1),at=t("div",{class:"w-full border-b border-orange-700"}," ",-1),nt={class:"transition-opacity"},rt=["onClick"],lt={class:"text-2xl font-light"},it={class:"ml-2 font-light uppercase text-md"},dt={key:0,class:"float-right text-2xl font-light"},ut=["title"],ct=t("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"},null,-1),pt={key:0,class:"inline-block w-20 font-semibold"},mt={class:"leading-relaxed border-b border-orange-700"},_t=["onClick"],bt=["onClick"],T=5,C=3,vt={__name:"AgendaPage",setup(L){const i=q(),y=_e(),d=re(),_=B(),m=H(()=>{const x=parseInt(i.params.week);return x>26&&x<34&&y.push({name:i.name,params:{...i.params,week:34}}),x}),p=H(()=>ge(i.params.promotion,m.value)),{result:c,error:K}=te(I,()=>({promotion:i.params.promotion,year:p.value,week:m.value}));return(x,P)=>{var $,U,S;return n(),r("div",He,[t("div",Xe,[t("h1",Ze,[f(" Semaine "+l(m.value)+" ",1),t("span",et,l(p.value),1)]),tt,t("div",ot,[e(K)?(n(),be(Z,{key:0,appear:""},{default:X(()=>[st]),_:1})):(n(),r(k,{key:1},[f(" ")],64))]),at]),(n(!0),r(k,null,M(((S=(U=($=e(c))==null?void 0:$.week)==null?void 0:U.days)==null?void 0:S.map(a=>({...a,strDate:a.date,date:new Date(a.date)})))||[],(a,b)=>(n(),r("div",{key:b,class:"w-full xl:w-1/2 xl:pr-16"},[he(Z,{appear:""},{default:X(()=>[t("div",nt,[t("h2",{onClick:u=>a.tasks.length?[e(_).component=ee,e(_).additionalData={day:a}]:[],class:ve(["px-1 text-white bg-orange-700",{"cursor-pointer":a.tasks.length}])},[t("span",lt,l(a.date.getDate()),1),t("span",it,l(e(oe)[a.date.getDay()]),1),b==0||a.date.getDate()==1?(n(),r("span",dt,l(e(se)[a.date.getMonth()]),1)):g("",!0)],10,rt),t("ul",null,[(n(!0),r(k,null,M([...a.tasks].sort(e(ne)).slice(0,(a.date.getDay()?T:C)-1),u=>(n(),r("li",{key:u.id,class:"relative leading-relaxed truncate border-b border-orange-700",title:u.title},[ct,f(" "+l()+" ",1),u.matter.shortName?(n(),r("span",pt,l(u.matter.abbr=="ecdr"&&e(i).params.promotion=="mtu2e"?"Droit":u.matter.shortName),1)):g("",!0),f(" "+l(e(ae)[u.type].emoji)+" "+l(u.title),1)],8,ut))),128)),t("li",mt,[a.tasks.length>=(a.date.getDay()?T:C)?(n(),r(k,{key:0},[f(" + "+l(a.tasks.length+1-(a.date.getDay()?T:C))+" "+l(a.tasks.length+1-(a.date.getDay()?T:C)>=2?"autres éléments":"autre élément")+" ",1),t("button",{onClick:u=>a.tasks.length?[e(_).component=ee,e(_).additionalData={day:a}]:[],class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Voir ",8,_t)],64)):g("",!0),e(d).isAdmin?(n(),r("button",{key:1,onClick:u=>{e(_).component=le,e(_).additionalData={date:a.strDate,promotion:e(i).params.promotion,matter:"",type:"homework",title:""}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Ajouter ",8,bt)):g("",!0),f("   ")]),(n(!0),r(k,null,M(Math.max((a.date.getDay()?T:C)-a.tasks.length-1,0),u=>(n(),r("li",{key:u,class:"leading-relaxed border-b border-orange-700"},"   "))),128))])])]),_:2},1024)]))),128))])}}};export{vt as default};
