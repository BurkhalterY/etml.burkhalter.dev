import{u as P,f as j,r as I,m as oe,g as X,p as Y,o as s,a as r,b as e,t as l,e as h,w as E,v as Z,d as t,h as N,q,F as x,l as M,s as ae,x as se,y as ne,z as re,A as ge,c as ee,i as f,B,C as Q,T as K,D as be,E as he,n as ve}from"./index-b7873fb5.js";import{G as ye,a as L,M as xe,D as ke,u as le}from"./auth-70786099.js";const we={class:"flex flex-col gap-2"},fe=t("h2",{class:"text-xl font-semibold text-center"},"Devoir",-1),De={key:0,class:"text-red-500"},$e={key:1,class:"text-red-500"},Se=t("label",null,"Date :",-1),Ee=t("label",null,"Classe :",-1),Ne=t("option",{value:"mtu1e"},"MTU1E",-1),Te=t("option",{value:"mtu2e"},"MTU2E",-1),Ce=[Ne,Te],Me=t("label",null,"Type :",-1),Ae=t("option",{value:"homework"},"Devoir",-1),Ue=t("option",{value:"test"},"Test",-1),Ve=t("option",{value:"info"},"Information",-1),Ie=[Ae,Ue,Ve],Qe=t("label",null,"Matière :",-1),Ke=["value"],Le=t("label",null,"Titre :",-1),Oe={class:"flex gap-1"},Re=["disabled"],Je=["disabled"],ie={__name:"TaskForm",setup(F){var z;const i=P(),k=j(),d=I({...k.additionalData}),_=I(((z=d.value.matter)==null?void 0:z.abbr)??""),m=I({...d.value}),{result:p}=oe(ye),{mutate:c,loading:O,error:g,onDone:G}=X(xe,()=>({variables:{...d.value,matter:_.value},update:(v,{data:{task:o}})=>{if(m.value.id){const w=new Date(m.value.date),W=(w.getDay()+6)%7,{year:ce,week:pe}=Y(w),H={query:L,variables:{promotion:m.value.promotion,year:ce,week:pe}},me=v.readQuery(H),J=JSON.parse(JSON.stringify(me));J.week.days[W].tasks=J.week.days[W].tasks.filter(_e=>_e.id!=m.value.id),v.writeQuery({...H,data:J})}const y=new Date(o.date),a=(y.getDay()+6)%7,{year:R,week:U}=Y(y),V={query:L,variables:{promotion:o.promotion,year:R,week:U}},D=v.readQuery(V);if(D){const w=JSON.parse(JSON.stringify(D));w.week.days[a].tasks.push(o),v.writeQuery({...V,data:w})}}}));G(()=>{k.component=null});const{mutate:$,loading:A,error:S,onDone:n}=X(ke,()=>({variables:{id:m.value.id},update:v=>{const o=new Date(m.value.date),y=(o.getDay()+6)%7,{year:a,week:R}=Y(o),U={query:L,variables:{promotion:i.params.promotion,year:a,week:R}},V=v.readQuery(U),D=JSON.parse(JSON.stringify(V));D.week.days[y].tasks=D.week.days[y].tasks.filter(w=>w.id!=m.value.id),v.writeQuery({...U,data:D})}}));n(()=>{k.component=null});const b=I(3);let u;const de=()=>{b.value--,u=setInterval(()=>{b.value--,b.value==0&&clearInterval(u)},1e3)},ue=()=>{clearInterval(u),b.value=3};return(v,o)=>{var y;return s(),r("div",we,[fe,e(g)?(s(),r("span",De,l(e(g).message),1)):h("",!0),e(S)?(s(),r("span",$e,l(e(S).message),1)):h("",!0),Se,E(t("input",{type:"date","onUpdate:modelValue":o[0]||(o[0]=a=>d.value.date=a),onKeyup:o[1]||(o[1]=N((...a)=>e(c)&&e(c)(...a),["enter"])),class:"p-2 border rounded-sm"},null,544),[[Z,d.value.date]]),Ee,E(t("select",{"onUpdate:modelValue":o[2]||(o[2]=a=>d.value.promotion=a),onKeyup:o[3]||(o[3]=N((...a)=>e(c)&&e(c)(...a),["enter"])),class:"p-2 bg-white border rounded-sm"},Ce,544),[[q,d.value.promotion]]),Me,E(t("select",{"onUpdate:modelValue":o[4]||(o[4]=a=>d.value.type=a),onKeyup:o[5]||(o[5]=N((...a)=>e(c)&&e(c)(...a),["enter"])),class:"p-2 bg-white border rounded-sm"},Ie,544),[[q,d.value.type]]),Qe,E(t("select",{"onUpdate:modelValue":o[6]||(o[6]=a=>_.value=a),onKeyup:o[7]||(o[7]=N((...a)=>e(c)&&e(c)(...a),["enter"])),class:"p-2 bg-white border rounded-sm"},[(s(!0),r(x,null,M(((y=e(p))==null?void 0:y.matters)||[],a=>(s(),r("option",{key:a.abbr,value:a.abbr},l(a.name),9,Ke))),128))],544),[[q,_.value]]),Le,E(t("input",{type:"text","onUpdate:modelValue":o[8]||(o[8]=a=>d.value.title=a),onKeyup:o[9]||(o[9]=N((...a)=>e(c)&&e(c)(...a),["enter"])),class:"p-2 border rounded-sm"},null,544),[[Z,d.value.title]]),t("div",Oe,[t("button",{onClick:o[10]||(o[10]=(...a)=>e(c)&&e(c)(...a)),class:"flex-grow p-2 mt-2 text-white rounded-sm bg-etml hover:opacity-90 active:opacity-80",disabled:e(O)}," Valider ",8,Re),d.value.id?(s(),r("button",{key:0,onMouseenter:de,onMouseleave:ue,onClick:o[11]||(o[11]=(...a)=>e($)&&e($)(...a)),class:"p-2 mt-2 font-semibold text-white bg-red-600 rounded-sm hover:opacity-90 active:opacity-80 aspect-square disabled:cursor-not-allowed",disabled:b.value||e(A)},l(b.value||"⨉"),41,Je)):h("",!0)])])}}},Ye={class:"px-1 text-white bg-orange-700"},qe={class:"text-2xl font-light"},Be={class:"ml-2 font-light uppercase text-md"},Pe={class:"float-right text-2xl font-light"},je=t("td",{class:"px-0 py-1 align-top"},[t("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"})],-1),Fe={key:0,class:"px-2 py-1 font-semibold align-top"},Ge=["colspan"],ze={key:1,class:"py-1 align-top"},We=["onClick"],te={__name:"DayPopup",setup(F){const i=j(),k=le(),d=P();return(_,m)=>(s(),r("div",null,[t("h2",Ye,[t("span",qe,l(e(i).additionalData.day.date.getDate()),1),t("span",Be,l(e(ae)[e(i).additionalData.day.date.getDay()]),1),t("span",Pe,l(e(se)[e(i).additionalData.day.date.getMonth()]),1)]),t("table",null,[(s(!0),r(x,null,M([...e(i).additionalData.day.tasks].sort(e(re)),p=>(s(),r("tr",{key:p.id,class:"leading-snug border-b border-orange-700"},[je,p.matter.shortName?(s(),r("td",Fe,l(p.matter.abbr=="ecdr"&&e(d).params.promotion=="mtu2e"?"Droit":p.matter.shortName),1)):h("",!0),t("td",{class:"px-2 py-1 align-top",colspan:p.matter.shortName?1:2},l(e(ne)[p.type].emoji)+" "+l(p.title),9,Ge),e(k).isAdmin?(s(),r("td",ze,[t("button",{onClick:c=>{e(i).component=ie,e(i).additionalData=p},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Éditer ",8,We)])):h("",!0)]))),128))])]))}},He={class:"flex flex-col flex-wrap gap-y-4 gap-x-16"},Xe={class:"w-full xl:w-1/2 xl:pr-16"},Ze={class:"text-2xl font-light border-b border-black"},et={class:"float-right"},tt=t("div",{class:"w-full border-b border-orange-700"},[t("h2",{class:"inline font-black text-orange-700 uppercase text-2xs"}," Communications ")],-1),ot={class:"w-full border-b border-orange-700"},at=t("div",{class:"text-center text-red-500 transition-opacity"}," Aucune connexion Internet. ",-1),st=t("div",{class:"text-center text-red-500 transition-opacity"}," Une erreur est survenue ",-1),nt={class:"w-full border-b border-orange-700"},rt=t("div",{class:"text-center text-red-500 transition-opacity"}," Les données peuvent ne pas être à jour. ",-1),lt={class:"transition-opacity"},it=["onClick"],dt={class:"text-2xl font-light"},ut={class:"ml-2 font-light uppercase text-md"},ct={key:0,class:"float-right text-2xl font-light"},pt=["title"],mt=t("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"},null,-1),_t={key:0,class:"inline-block w-20 font-semibold"},gt={class:"leading-relaxed border-b border-orange-700"},bt=["onClick"],ht=["onClick"],T=5,C=3,xt={__name:"AgendaPage",setup(F){const i=P(),k=ge(),d=le(),_=j(),m=ee(()=>{const g=parseInt(i.params.week);return g>26&&g<34&&k.push({name:i.name,params:{...i.params,week:34}}),g}),p=ee(()=>be(i.params.promotion,m.value)),{result:c,error:O}=oe(L,()=>({promotion:i.params.promotion,year:p.value,week:m.value}),{fetchPolicy:"cache-and-network"});return(g,G)=>{var $,A,S;return s(),r("div",He,[t("div",Xe,[t("h1",Ze,[f(" Semaine "+l(m.value)+" ",1),t("span",et,l(p.value),1)]),tt,t("div",ot,[g.navigator.onLine?e(O)?(s(),B(K,{key:1,appear:""},{default:Q(()=>[st]),_:1})):(s(),r(x,{key:2},[f(" ")],64)):(s(),B(K,{key:0,appear:""},{default:Q(()=>[at]),_:1}))]),t("div",nt,[g.navigator.onLine?(s(),r(x,{key:1},[f(" ")],64)):(s(),B(K,{key:0,appear:""},{default:Q(()=>[rt]),_:1}))])]),(s(!0),r(x,null,M(((S=(A=($=e(c))==null?void 0:$.week)==null?void 0:A.days)==null?void 0:S.map(n=>({...n,strDate:n.date,date:new Date(n.date)})))||[],(n,b)=>(s(),r("div",{key:b,class:"w-full xl:w-1/2 xl:pr-16"},[he(K,{appear:""},{default:Q(()=>[t("div",lt,[t("h2",{onClick:u=>n.tasks.length?[e(_).component=te,e(_).additionalData={day:n}]:[],class:ve(["px-1 text-white bg-orange-700",{"cursor-pointer":n.tasks.length}])},[t("span",dt,l(n.date.getDate()),1),t("span",ut,l(e(ae)[n.date.getDay()]),1),b==0||n.date.getDate()==1?(s(),r("span",ct,l(e(se)[n.date.getMonth()]),1)):h("",!0)],10,it),t("ul",null,[(s(!0),r(x,null,M([...n.tasks].sort(e(re)).slice(0,(n.date.getDay()?T:C)-1),u=>(s(),r("li",{key:u.id,class:"relative leading-relaxed truncate border-b border-orange-700",title:u.title},[mt,f(" "+l()+" ",1),u.matter.shortName?(s(),r("span",_t,l(u.matter.abbr=="ecdr"&&e(i).params.promotion=="mtu2e"?"Droit":u.matter.shortName),1)):h("",!0),f(" "+l(e(ne)[u.type].emoji)+" "+l(u.title),1)],8,pt))),128)),t("li",gt,[n.tasks.length>=(n.date.getDay()?T:C)?(s(),r(x,{key:0},[f(" + "+l(n.tasks.length+1-(n.date.getDay()?T:C))+" "+l(n.tasks.length+1-(n.date.getDay()?T:C)>=2?"autres éléments":"autre élément")+" ",1),t("button",{onClick:u=>n.tasks.length?[e(_).component=te,e(_).additionalData={day:n}]:[],class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Voir ",8,bt)],64)):h("",!0),e(d).isAdmin?(s(),r("button",{key:1,onClick:u=>{e(_).component=ie,e(_).additionalData={date:n.strDate,promotion:e(i).params.promotion,matter:"",type:"homework",title:""}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Ajouter ",8,ht)):h("",!0),f("   ")]),(s(!0),r(x,null,M(Math.max((n.date.getDay()?T:C)-n.tasks.length-1,0),u=>(s(),r("li",{key:u,class:"leading-relaxed border-b border-orange-700"},"   "))),128))])])]),_:2},1024)]))),128))])}}};export{xt as default};
