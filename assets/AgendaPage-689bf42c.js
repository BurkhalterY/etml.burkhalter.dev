import{u as P,d as j,r as I,m as ee,e as W,p as q,o as n,a as r,f as e,t as l,g as h,w as $,v as H,b as t,h as S,q as B,F as k,l as C,s as te,x as oe,y as se,z as ae,A as ue,c as X,i as E,B as ce,C as pe,T as me,D as _e,n as Z}from"./index-287e0e1d.js";import{G as he,a as K,M as be,D as ge,u as ne}from"./auth-412027d2.js";const ve={class:"flex flex-col gap-2"},xe=t("h2",{class:"text-xl font-bold text-center"},"Devoir",-1),ye={key:0,class:"text-red-500"},we={key:1,class:"text-red-500"},De=t("label",null,"Date :",-1),ke=t("label",null,"Classe :",-1),fe=t("option",{value:"mtu1e"},"MTU1E",-1),$e=t("option",{value:"mtu2e"},"MTU2E",-1),Se=[fe,$e],Ee=t("label",null,"Type :",-1),Ne=t("option",{value:"homework"},"Devoir",-1),Te=t("option",{value:"test"},"Test",-1),Ce=t("option",{value:"info"},"Information",-1),Ae=[Ne,Te,Ce],Me=t("label",null,"Matière :",-1),Ue=["value"],Qe=t("label",null,"Titre :",-1),Ie={class:"flex gap-1"},Ke=["disabled"],L={__name:"TaskForm",setup(F){var R;const d=P(),x=j(),i=I({...x.additionalData}),m=I(((R=i.value.matter)==null?void 0:R.abbr)??""),_=I({...i.value}),{result:c}=ee(he),{mutate:u,error:A,onDone:w}=W(be,()=>({variables:{...i.value,matter:m.value},update:(g,{data:{task:o}})=>{if(_.value.id){const y=new Date(_.value.date),G=(y.getDay()+6)%7,{year:re,week:le}=q(y),z={query:K,variables:{promotion:d.params.promotion,year:re,week:le}},ie=g.readQuery(z),Y=JSON.parse(JSON.stringify(ie));Y.week.days[G].tasks=Y.week.days[G].tasks.filter(de=>de.id!=_.value.id),g.writeQuery({...z,data:Y})}const v=new Date(o.date),s=(v.getDay()+6)%7,{year:J,week:U}=q(v),Q={query:K,variables:{promotion:d.params.promotion,year:J,week:U}},D=g.readQuery(Q);if(D){const y=JSON.parse(JSON.stringify(D));y.week.days[s].tasks.push(o),g.writeQuery({...Q,data:y})}}}));w(()=>{x.component=!1});const{mutate:V,error:f,onDone:M}=W(ge,()=>({variables:{id:_.value.id},update:g=>{const o=new Date(_.value.date),v=(o.getDay()+6)%7,{year:s,week:J}=q(o),U={query:K,variables:{promotion:d.params.promotion,year:s,week:J}},Q=g.readQuery(U),D=JSON.parse(JSON.stringify(Q));D.week.days[v].tasks=D.week.days[v].tasks.filter(y=>y.id!=_.value.id),g.writeQuery({...U,data:D})}}));M(()=>{x.component=!1});const b=I(3);let a;const O=()=>{b.value--,a=setInterval(()=>{b.value--,b.value==0&&clearInterval(a)},1e3)},p=()=>{clearInterval(a),b.value=3};return(g,o)=>{var v;return n(),r("div",ve,[xe,e(A)?(n(),r("span",ye,l(e(A).message),1)):h("",!0),e(f)?(n(),r("span",we,l(e(f).message),1)):h("",!0),De,$(t("input",{type:"date","onUpdate:modelValue":o[0]||(o[0]=s=>i.value.date=s),class:"p-2 border rounded-sm",onKeyup:o[1]||(o[1]=S((...s)=>e(u)&&e(u)(...s),["enter"]))},null,544),[[H,i.value.date]]),ke,$(t("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>i.value.promotion=s),class:"p-2 bg-white border rounded-sm",onKeyup:o[3]||(o[3]=S((...s)=>e(u)&&e(u)(...s),["enter"]))},Se,544),[[B,i.value.promotion]]),Ee,$(t("select",{"onUpdate:modelValue":o[4]||(o[4]=s=>i.value.type=s),class:"p-2 bg-white border rounded-sm",onKeyup:o[5]||(o[5]=S((...s)=>e(u)&&e(u)(...s),["enter"]))},Ae,544),[[B,i.value.type]]),Me,$(t("select",{"onUpdate:modelValue":o[6]||(o[6]=s=>m.value=s),class:"p-2 bg-white border rounded-sm",onKeyup:o[7]||(o[7]=S((...s)=>e(u)&&e(u)(...s),["enter"]))},[(n(!0),r(k,null,C(((v=e(c))==null?void 0:v.matters)||[],s=>(n(),r("option",{value:s.abbr},l(s.name),9,Ue))),256))],544),[[B,m.value]]),Qe,$(t("input",{type:"text","onUpdate:modelValue":o[8]||(o[8]=s=>i.value.title=s),class:"p-2 border rounded-sm",onKeyup:o[9]||(o[9]=S((...s)=>e(u)&&e(u)(...s),["enter"]))},null,544),[[H,i.value.title]]),t("div",Ie,[t("button",{onClick:o[10]||(o[10]=(...s)=>e(u)&&e(u)(...s)),class:"flex-grow p-2 mt-2 text-white rounded-sm bg-etml hover:opacity-90 active:opacity-80"}," Valider "),i.value.id?(n(),r("button",{key:0,onMouseenter:O,onMouseleave:p,onClick:o[11]||(o[11]=(...s)=>e(V)&&e(V)(...s)),class:"p-2 mt-2 font-bold text-white bg-red-600 rounded-sm hover:opacity-90 active:opacity-80 aspect-square disabled:cursor-not-allowed",disabled:b.value},l(b.value||"⨉"),41,Ke)):h("",!0)])])}}},Ve={class:"px-1 text-white bg-orange-700"},Oe={class:"text-2xl font-light"},Re={class:"ml-2 font-light uppercase text-md"},Je={class:"float-right text-2xl font-light"},Ye={class:"leading-relaxed border-b border-orange-700"},qe=t("td",{class:"inline-block w-4 h-4 border border-orange-700 cursor-pointer"},null,-1),Be={key:0,class:"px-2 font-bold align-top"},Le=["colspan"],Pe={key:1,class:"align-top"},je=["onClick"],Fe={__name:"DayPopup",setup(F){const d=j(),x=ne(),i=P();return(m,_)=>(n(),r("div",null,[t("h2",Ve,[t("span",Oe,l(e(d).additionalData.day.date.getDate()),1),t("span",Re,l(e(te)[e(d).additionalData.day.date.getDay()]),1),t("span",Je,l(e(oe)[e(d).additionalData.day.date.getMonth()]),1)]),t("table",null,[(n(!0),r(k,null,C([...e(d).additionalData.day.tasks].sort(e(ae)),c=>(n(),r("tr",Ye,[qe,c.matter.shortName?(n(),r("td",Be,l(c.matter.abbr=="ecdr"&&e(i).params.promotion=="mtu2e"?"Droit":c.matter.shortName),1)):h("",!0),t("td",{class:"px-2 align-top",colspan:c.matter.shortName?1:2},l(e(se)[c.type].emoji)+" "+l(c.title),9,Le),e(x).isAdmin?(n(),r("td",Pe,[t("button",{onClick:u=>{e(d).component=L,e(d).additionalData=c},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Editer ",8,je)])):h("",!0)]))),256))])]))}},Ge={class:"flex flex-col flex-wrap gap-y-4 gap-x-16"},ze={class:"w-full xl:w-1/2 xl:pr-16"},We={class:"text-2xl font-light border-b border-black"},He={class:"float-right"},Xe=t("div",{class:"w-full border-b border-orange-700"},[t("h2",{class:"inline font-bold text-orange-700 uppercase text-2xs"}," Communications ")],-1),Ze={class:"w-full border-b border-orange-700"},et=t("div",{class:"text-center text-red-500"},"Une erreur est survenue",-1),tt=t("div",{class:"w-full border-b border-orange-700"}," ",-1),ot={class:"w-full xl:w-1/2 xl:pr-16"},st=["onClick"],at={class:"text-2xl font-light"},nt={class:"ml-2 font-light uppercase text-md"},rt={key:0,class:"float-right text-2xl font-light"},lt=t("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"},null,-1),it={key:0,class:"inline-block w-20"},dt=["title"],ut=["onClick"],ct={class:"leading-relaxed border-b border-orange-700"},pt={key:0},mt=["onClick"],_t={class:"leading-relaxed border-b border-orange-700"},N=5,T=3,gt={__name:"AgendaPage",setup(F){const d=P(),x=ue(),i=ne(),m=j(),_=X(()=>{const w=parseInt(d.params.week);return w>26&&w<34&&x.push({name:d.name,params:{...d.params,week:34}}),w}),c=X(()=>_e(d.params.promotion,_.value)),{result:u,error:A}=ee(K,()=>({promotion:d.params.promotion,year:c.value,week:_.value}));return(w,V)=>{var f,M,b;return n(),r("div",Ge,[t("div",ze,[t("h1",We,[E(" Semaine "+l(_.value)+" ",1),t("span",He,l(c.value),1)]),Xe,t("div",Ze,[e(A)?(n(),ce(me,{key:0,appear:""},{default:pe(()=>[et]),_:1})):(n(),r(k,{key:1},[E(" ")],64))]),tt]),(n(!0),r(k,null,C(((b=(M=(f=e(u))==null?void 0:f.week)==null?void 0:M.days)==null?void 0:b.map(a=>({...a,strDate:a.date,date:new Date(a.date)})))||[],(a,O)=>(n(),r("div",ot,[t("h2",{class:Z(["px-1 text-white bg-orange-700",{"cursor-pointer":a.tasks.length}]),onClick:p=>a.tasks.length?[e(m).component=Fe,e(m).additionalData={day:a}]:[]},[t("span",at,l(a.date.getDate()),1),t("span",nt,l(e(te)[a.date.getDay()]),1),O==0||a.date.getDate()==1?(n(),r("span",rt,l(e(oe)[a.date.getMonth()]),1)):h("",!0)],10,st),t("ul",null,[(n(!0),r(k,null,C([...a.tasks].sort(e(ae)).slice(0,(a.date.getDay()?N:T)-1),p=>(n(),r("li",{class:Z(["relative leading-relaxed truncate border-b border-orange-700",{"pr-8":e(i).isAdmin}])},[lt,E(" "+l()+" ",1),p.matter.shortName?(n(),r("strong",it,l(p.matter.abbr=="ecdr"&&e(d).params.promotion=="mtu2e"?"Droit":p.matter.shortName),1)):h("",!0),E(" "+l(e(se)[p.type].emoji)+" ",1),t("span",{title:p.title},l(p.title),9,dt),e(i).isAdmin?(n(),r("button",{key:1,onClick:R=>{e(m).component=L,e(m).additionalData=p},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml absolute right-0 my-1"}," Éditer ",8,ut)):h("",!0)],2))),256)),t("li",ct,[a.tasks.length>=(a.date.getDay()?N:T)?(n(),r("span",pt," + "+l(a.tasks.length+1-(a.date.getDay()?N:T))+" "+l(a.tasks.length+1-(a.date.getDay()?N:T)>=2?"autres éléments":"autre élément"),1)):h("",!0),e(i).isAdmin?(n(),r("button",{key:1,onClick:p=>{e(m).component=L,e(m).additionalData={date:a.strDate,promotion:"mtu2e",matter:"",type:"homework",title:""}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Ajouter ",8,mt)):h("",!0),E("   ")]),(n(!0),r(k,null,C(Math.max((a.date.getDay()?N:T)-a.tasks.length-1,0),p=>(n(),r("li",_t,"   "))),256))])]))),256))])}}};export{gt as default};
