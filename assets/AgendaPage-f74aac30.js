import{u as q,f as B,r as V,m as Z,g as z,p as J,o as n,a as r,b as e,t as l,e as g,w as E,v as W,d as t,h as N,q as Y,F as k,l as M,s as ee,x as te,y as oe,z as se,A as pe,c as H,i as f,B as me,C as _e,T as be,D as ge,n as he}from"./index-ef92dbf6.js";import{G as ve,a as I,M as xe,D as ye,u as ae}from"./auth-ded67a18.js";const we={class:"flex flex-col gap-2"},ke=t("h2",{class:"text-xl font-semibold text-center"},"Devoir",-1),De={key:0,class:"text-red-500"},fe={key:1,class:"text-red-500"},$e=t("label",null,"Date :",-1),Se=t("label",null,"Classe :",-1),Ee=t("option",{value:"mtu1e"},"MTU1E",-1),Ne=t("option",{value:"mtu2e"},"MTU2E",-1),Te=[Ee,Ne],Ce=t("label",null,"Type :",-1),Me=t("option",{value:"homework"},"Devoir",-1),Ue=t("option",{value:"test"},"Test",-1),Ae=t("option",{value:"info"},"Information",-1),Qe=[Me,Ue,Ae],Ve=t("label",null,"Matière :",-1),Ie=["value"],Ke=t("label",null,"Titre :",-1),Oe={class:"flex gap-1"},Re=["disabled"],Je=["disabled"],ne={__name:"TaskForm",setup(L){var j;const i=q(),x=B(),d=V({...x.additionalData}),_=V(((j=d.value.matter)==null?void 0:j.abbr)??""),m=V({...d.value}),{result:p}=Z(ve),{mutate:c,loading:K,error:y,onDone:P}=z(xe,()=>({variables:{...d.value,matter:_.value},update:(h,{data:{task:o}})=>{if(m.value.id){const w=new Date(m.value.date),F=(w.getDay()+6)%7,{year:ie,week:de}=J(w),G={query:I,variables:{promotion:m.value.promotion,year:ie,week:de}},ue=h.readQuery(G),R=JSON.parse(JSON.stringify(ue));R.week.days[F].tasks=R.week.days[F].tasks.filter(ce=>ce.id!=m.value.id),h.writeQuery({...G,data:R})}const v=new Date(o.date),s=(v.getDay()+6)%7,{year:O,week:A}=J(v),Q={query:I,variables:{promotion:o.promotion,year:O,week:A}},D=h.readQuery(Q);if(D){const w=JSON.parse(JSON.stringify(D));w.week.days[s].tasks.push(o),h.writeQuery({...Q,data:w})}}}));P(()=>{x.component=null});const{mutate:$,loading:U,error:S,onDone:a}=z(ye,()=>({variables:{id:m.value.id},update:h=>{const o=new Date(m.value.date),v=(o.getDay()+6)%7,{year:s,week:O}=J(o),A={query:I,variables:{promotion:i.params.promotion,year:s,week:O}},Q=h.readQuery(A),D=JSON.parse(JSON.stringify(Q));D.week.days[v].tasks=D.week.days[v].tasks.filter(w=>w.id!=m.value.id),h.writeQuery({...A,data:D})}}));a(()=>{x.component=null});const b=V(3);let u;const re=()=>{b.value--,u=setInterval(()=>{b.value--,b.value==0&&clearInterval(u)},1e3)},le=()=>{clearInterval(u),b.value=3};return(h,o)=>{var v;return n(),r("div",we,[ke,e(y)?(n(),r("span",De,l(e(y).message),1)):g("",!0),e(S)?(n(),r("span",fe,l(e(S).message),1)):g("",!0),$e,E(t("input",{type:"date","onUpdate:modelValue":o[0]||(o[0]=s=>d.value.date=s),onKeyup:o[1]||(o[1]=N((...s)=>e(c)&&e(c)(...s),["enter"])),class:"p-2 border rounded-sm"},null,544),[[W,d.value.date]]),Se,E(t("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>d.value.promotion=s),onKeyup:o[3]||(o[3]=N((...s)=>e(c)&&e(c)(...s),["enter"])),class:"p-2 bg-white border rounded-sm"},Te,544),[[Y,d.value.promotion]]),Ce,E(t("select",{"onUpdate:modelValue":o[4]||(o[4]=s=>d.value.type=s),onKeyup:o[5]||(o[5]=N((...s)=>e(c)&&e(c)(...s),["enter"])),class:"p-2 bg-white border rounded-sm"},Qe,544),[[Y,d.value.type]]),Ve,E(t("select",{"onUpdate:modelValue":o[6]||(o[6]=s=>_.value=s),onKeyup:o[7]||(o[7]=N((...s)=>e(c)&&e(c)(...s),["enter"])),class:"p-2 bg-white border rounded-sm"},[(n(!0),r(k,null,M(((v=e(p))==null?void 0:v.matters)||[],s=>(n(),r("option",{key:s.abbr,value:s.abbr},l(s.name),9,Ie))),128))],544),[[Y,_.value]]),Ke,E(t("input",{type:"text","onUpdate:modelValue":o[8]||(o[8]=s=>d.value.title=s),onKeyup:o[9]||(o[9]=N((...s)=>e(c)&&e(c)(...s),["enter"])),class:"p-2 border rounded-sm"},null,544),[[W,d.value.title]]),t("div",Oe,[t("button",{onClick:o[10]||(o[10]=(...s)=>e(c)&&e(c)(...s)),class:"flex-grow p-2 mt-2 text-white rounded-sm bg-etml hover:opacity-90 active:opacity-80",disabled:e(K)}," Valider ",8,Re),d.value.id?(n(),r("button",{key:0,onMouseenter:re,onMouseleave:le,onClick:o[11]||(o[11]=(...s)=>e($)&&e($)(...s)),class:"p-2 mt-2 font-semibold text-white bg-red-600 rounded-sm hover:opacity-90 active:opacity-80 aspect-square disabled:cursor-not-allowed",disabled:b.value||e(U)},l(b.value||"⨉"),41,Je)):g("",!0)])])}}},Ye={class:"px-1 text-white bg-orange-700"},qe={class:"text-2xl font-light"},Be={class:"ml-2 font-light uppercase text-md"},Le={class:"float-right text-2xl font-light"},Pe=t("td",{class:"px-0 py-1 align-top"},[t("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"})],-1),je={key:0,class:"px-2 py-1 font-semibold align-top"},Fe=["colspan"],Ge={key:1,class:"py-1 align-top"},ze=["onClick"],X={__name:"DayPopup",setup(L){const i=B(),x=ae(),d=q();return(_,m)=>(n(),r("div",null,[t("h2",Ye,[t("span",qe,l(e(i).additionalData.day.date.getDate()),1),t("span",Be,l(e(ee)[e(i).additionalData.day.date.getDay()]),1),t("span",Le,l(e(te)[e(i).additionalData.day.date.getMonth()]),1)]),t("table",null,[(n(!0),r(k,null,M([...e(i).additionalData.day.tasks].sort(e(se)),p=>(n(),r("tr",{key:p.id,class:"leading-snug border-b border-orange-700"},[Pe,p.matter.shortName?(n(),r("td",je,l(p.matter.abbr=="ecdr"&&e(d).params.promotion=="mtu2e"?"Droit":p.matter.shortName),1)):g("",!0),t("td",{class:"px-2 py-1 align-top",colspan:p.matter.shortName?1:2},l(e(oe)[p.type].emoji)+" "+l(p.title),9,Fe),e(x).isAdmin?(n(),r("td",Ge,[t("button",{onClick:c=>{e(i).component=ne,e(i).additionalData=p},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Éditer ",8,ze)])):g("",!0)]))),128))])]))}},We={class:"flex flex-col flex-wrap gap-y-4 gap-x-16"},He={class:"w-full xl:w-1/2 xl:pr-16"},Xe={class:"text-2xl font-light border-b border-black"},Ze={class:"float-right"},et=t("div",{class:"w-full border-b border-orange-700"},[t("h2",{class:"inline font-black text-orange-700 uppercase text-2xs"}," Communications ")],-1),tt={class:"w-full border-b border-orange-700"},ot=t("div",{class:"text-center text-red-500"},"Une erreur est survenue",-1),st=t("div",{class:"w-full border-b border-orange-700"}," ",-1),at=["onClick"],nt={class:"text-2xl font-light"},rt={class:"ml-2 font-light uppercase text-md"},lt={key:0,class:"float-right text-2xl font-light"},it=["title"],dt=t("div",{class:"inline-block w-4 h-4 mb-1 align-middle border border-orange-700 cursor-pointer"},null,-1),ut={key:0,class:"inline-block w-20 font-semibold"},ct={class:"leading-relaxed border-b border-orange-700"},pt=["onClick"],mt=["onClick"],T=5,C=3,gt={__name:"AgendaPage",setup(L){const i=q(),x=pe(),d=ae(),_=B(),m=H(()=>{const y=parseInt(i.params.week);return y>26&&y<34&&x.push({name:i.name,params:{...i.params,week:34}}),y}),p=H(()=>ge(i.params.promotion,m.value)),{result:c,error:K}=Z(I,()=>({promotion:i.params.promotion,year:p.value,week:m.value}));return(y,P)=>{var $,U,S;return n(),r("div",We,[t("div",He,[t("h1",Xe,[f(" Semaine "+l(m.value)+" ",1),t("span",Ze,l(p.value),1)]),et,t("div",tt,[e(K)?(n(),me(be,{key:0,appear:""},{default:_e(()=>[ot]),_:1})):(n(),r(k,{key:1},[f(" ")],64))]),st]),(n(!0),r(k,null,M(((S=(U=($=e(c))==null?void 0:$.week)==null?void 0:U.days)==null?void 0:S.map(a=>({...a,strDate:a.date,date:new Date(a.date)})))||[],(a,b)=>(n(),r("div",{key:b,class:"w-full xl:w-1/2 xl:pr-16"},[t("h2",{onClick:u=>a.tasks.length?[e(_).component=X,e(_).additionalData={day:a}]:[],class:he(["px-1 text-white bg-orange-700",{"cursor-pointer":a.tasks.length}])},[t("span",nt,l(a.date.getDate()),1),t("span",rt,l(e(ee)[a.date.getDay()]),1),b==0||a.date.getDate()==1?(n(),r("span",lt,l(e(te)[a.date.getMonth()]),1)):g("",!0)],10,at),t("ul",null,[(n(!0),r(k,null,M([...a.tasks].sort(e(se)).slice(0,(a.date.getDay()?T:C)-1),u=>(n(),r("li",{key:u.id,class:"relative leading-relaxed truncate border-b border-orange-700",title:u.title},[dt,f(" "+l()+" ",1),u.matter.shortName?(n(),r("span",ut,l(u.matter.abbr=="ecdr"&&e(i).params.promotion=="mtu2e"?"Droit":u.matter.shortName),1)):g("",!0),f(" "+l(e(oe)[u.type].emoji)+" "+l(u.title),1)],8,it))),128)),t("li",ct,[a.tasks.length>=(a.date.getDay()?T:C)?(n(),r(k,{key:0},[f(" + "+l(a.tasks.length+1-(a.date.getDay()?T:C))+" "+l(a.tasks.length+1-(a.date.getDay()?T:C)>=2?"autres éléments":"autre élément")+" ",1),t("button",{onClick:u=>a.tasks.length?[e(_).component=X,e(_).additionalData={day:a}]:[],class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Voir ",8,pt)],64)):g("",!0),e(d).isAdmin?(n(),r("button",{key:1,onClick:u=>{e(_).component=ne,e(_).additionalData={date:a.strDate,promotion:e(i).params.promotion,matter:"",type:"homework",title:""}},class:"mx-0.5 px-0.5 rounded text-sm text-white bg-etml"}," Ajouter ",8,mt)):g("",!0),f("   ")]),(n(!0),r(k,null,M(Math.max((a.date.getDay()?T:C)-a.tasks.length-1,0),u=>(n(),r("li",{key:u,class:"leading-relaxed border-b border-orange-700"},"   "))),128))])]))),128))])}}};export{gt as default};
